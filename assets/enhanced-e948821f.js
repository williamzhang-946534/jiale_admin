import{v as e,k as a,r as l,c as t,l as s,ak as i,aq as n,y as r,B as d,E as u,C as o,D as c,u as p,M as v,z as m,O as f,L as g,ag as b,J as y,P as _,a3 as h}from"./vendor-60cd9ffe.js";import{v as w,x as k,E as V,f as z}from"./element-ca729cb6.js";import{g as x,a as S,b as C}from"./user-3272a809.js";import{g as T}from"./marketing-7335aaa0.js";import{_ as O}from"./index-30b3d731.js";const I={class:"user-page"},U={class:"toolbar"},P={class:"toolbar-left"},$={class:"toolbar-right"},D={class:"stats-cards"},j={class:"stat-content"},L={class:"stat-number"},q={class:"stat-content"},B={class:"stat-number"},N={class:"stat-content"},M={class:"stat-number"},A={class:"stat-content"},E={class:"stat-number"},J={class:"table-container"},K={class:"user-info"},R={class:"user-details"},F={class:"user-name"},G={class:"user-phone"},H={class:"user-tags"},Q={class:"balance"},W={class:"points"},X={class:"total-spent"},Y={class:"pagination-container"},Z={key:0,class:"user-detail"},ee={class:"account-overview"},ae={class:"account-item"},le={class:"account-value"},te={class:"account-item"},se={class:"account-value"},ie={class:"account-item"},ne={class:"account-value"},re={key:0,class:"addresses-section"},de={class:"addresses-list"},ue={class:"address-info"},oe={class:"address-contact"},ce={class:"contact-name"},pe={class:"contact-phone"},ve={class:"address-detail"},me={key:1,class:"recent-orders-section"},fe=O(e({__name:"enhanced",setup(e){const O=a({keyword:"",level:"",status:"",page:1,pageSize:20}),fe=a({page:1,pageSize:20,total:0,pageSizes:[10,20,50,100]}),ge=l(!1),be=l([]),ye=l([]),_e=l([]),he=t(()=>{const e=be.value.length,a=be.value.filter(e=>"active"===e.status).length,l=be.value.filter(e=>["vip","svip"].includes(e.level||"")).length,t=(new Date).getMonth();return{total:e,active:a,vip:l,newUsers:be.value.filter(e=>new Date(e.createTime).getMonth()===t).length}}),we=a({visible:!1,user:null}),ke=a({visible:!1,user:null,form:{couponId:"",quantity:1,remark:""},loading:!1}),Ve=e=>({normal:"",vip:"warning",svip:"danger"}[e]||""),ze=e=>({normal:"普通会员",vip:"VIP会员",svip:"SVIP会员"}[e]||"普通会员"),xe=e=>({pending:"待指派",accepted:"已接受",in_service:"服务中",completed:"已完成",cancelled:"已取消"}[e]||e),Se=e=>e?new Date(e).toLocaleString("zh-CN"):"无",Ce=async()=>{ge.value=!0;try{const e={...O,page:fe.page,pageSize:fe.pageSize},a=await x(e);be.value=a.list,fe.total=a.total}catch(e){V.error("获取用户列表失败"),be.value=[{id:"1",username:"user001",nickname:"张三",phone:"13800138001",level:"vip",status:"active",balance:150.5,points:2800,createTime:"2023-10-01 10:30:00",lastLoginTime:"2024-01-19 15:20:00",stats:{totalOrders:15,totalSpent:2580,avgOrderValue:172,lastOrderTime:"2024-01-15 14:00:00"}},{id:"2",username:"user002",nickname:"李四",phone:"13800138002",level:"svip",status:"active",balance:320,points:5600,createTime:"2023-09-15 09:20:00",lastLoginTime:"2024-01-19 18:45:00",stats:{totalOrders:32,totalSpent:5420,avgOrderValue:169,lastOrderTime:"2024-01-18 16:30:00"}}],fe.total=2}finally{ge.value=!1}},Te=()=>{fe.page=1,Ce()},Oe=()=>{Ce()},Ie=e=>{ye.value=e},Ue=e=>{ke.user=e,ke.form={couponId:"",quantity:1,remark:""},ke.visible=!0,(async()=>{try{const e=await T();_e.value=e.filter(e=>"active"===e.status)}catch(e){_e.value=[{id:"coupon1",name:"新客专享",amount:20,minSpend:100,status:"active"},{id:"coupon2",name:"保洁优惠",amount:50,minSpend:200,status:"active"},{id:"coupon3",name:"会员专享",amount:100,minSpend:300,status:"active"}]}})()},Pe=()=>{0!==ye.value.length?V.info("批量赠券功能开发中，请单独为每个用户赠券"):V.warning("请选择用户")},$e=async()=>{if(ke.user&&ke.form.couponId){ke.loading=!0;try{await C(ke.user.id,ke.form.couponId),V.success("优惠券赠送成功"),ke.visible=!1}catch(e){V.error("优惠券赠送失败")}finally{ke.loading=!1}}else V.warning("请选择优惠券")},De=e=>{fe.pageSize=e,fe.page=1,Ce()},je=e=>{fe.page=e,Ce()};return s(()=>{Ce()}),(e,a)=>{var l,t,s,x;const C=i("el-button"),T=i("el-input"),Le=i("el-option"),qe=i("el-select"),Be=i("el-card"),Ne=i("el-table-column"),Me=i("el-avatar"),Ae=i("el-tag"),Ee=i("el-link"),Je=i("el-table"),Ke=i("el-pagination"),Re=i("el-descriptions-item"),Fe=i("el-descriptions"),Ge=i("el-col"),He=i("el-row"),Qe=i("el-dialog"),We=i("el-form-item"),Xe=i("el-input-number"),Ye=i("el-form"),Ze=n("loading");return r(),d("div",I,[u("div",U,[u("div",P,[o(C,{type:"primary",onClick:Oe},{default:c(()=>[o(p(w)),a[11]||(a[11]=v(" 刷新 ",-1))]),_:1}),ye.value.length>0?(r(),m(C,{key:0,type:"success",onClick:Pe},{default:c(()=>[v(" 批量赠券 ("+f(ye.value.length)+") ",1)]),_:1})):g("",!0)]),u("div",$,[o(T,{modelValue:O.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>O.keyword=e),placeholder:"手机号/昵称",style:{width:"220px"},clearable:"",onClear:Te,onKeyup:b(Te,["enter"])},{prefix:c(()=>[o(p(k))]),_:1},8,["modelValue"]),o(qe,{modelValue:O.level,"onUpdate:modelValue":a[1]||(a[1]=e=>O.level=e),placeholder:"会员等级",style:{width:"140px"},clearable:"",onChange:Te},{default:c(()=>[o(Le,{label:"全部",value:""}),o(Le,{label:"普通会员",value:"normal"}),o(Le,{label:"VIP会员",value:"vip"}),o(Le,{label:"SVIP会员",value:"svip"})]),_:1},8,["modelValue"]),o(qe,{modelValue:O.status,"onUpdate:modelValue":a[2]||(a[2]=e=>O.status=e),placeholder:"状态",style:{width:"120px"},clearable:"",onChange:Te},{default:c(()=>[o(Le,{label:"正常",value:"active"}),o(Le,{label:"封禁",value:"banned"})]),_:1},8,["modelValue"])])]),u("div",D,[o(Be,{class:"stat-card"},{default:c(()=>[u("div",j,[u("div",L,f(he.value.total),1),a[12]||(a[12]=u("div",{class:"stat-label"},"总用户数",-1))])]),_:1}),o(Be,{class:"stat-card active"},{default:c(()=>[u("div",q,[u("div",B,f(he.value.active),1),a[13]||(a[13]=u("div",{class:"stat-label"},"活跃用户",-1))])]),_:1}),o(Be,{class:"stat-card vip"},{default:c(()=>[u("div",N,[u("div",M,f(he.value.vip),1),a[14]||(a[14]=u("div",{class:"stat-label"},"VIP用户",-1))])]),_:1}),o(Be,{class:"stat-card new"},{default:c(()=>[u("div",A,[u("div",E,f(he.value.newUsers),1),a[15]||(a[15]=u("div",{class:"stat-label"},"本月新增",-1))])]),_:1})]),u("div",J,[y((r(),m(Je,{data:be.value,stripe:"",style:{width:"100%"},onSelectionChange:Ie},{default:c(()=>[o(Ne,{type:"selection",width:"55"}),o(Ne,{label:"用户信息","min-width":"200"},{default:c(({row:e})=>[u("div",K,[o(Me,{src:e.avatar,size:50},{default:c(()=>{var a,l;return[v(f((null==(a=e.nickname)?void 0:a.charAt(0))||(null==(l=e.username)?void 0:l.charAt(0))),1)]}),_:2},1032,["src"]),u("div",R,[u("div",F,f(e.nickname||e.username),1),u("div",G,f(e.phone),1),u("div",H,["svip"===e.level?(r(),m(Ae,{key:0,type:"danger",size:"small"},{default:c(()=>[...a[16]||(a[16]=[v("SVIP",-1)])]),_:1})):"vip"===e.level?(r(),m(Ae,{key:1,type:"warning",size:"small"},{default:c(()=>[...a[17]||(a[17]=[v("VIP",-1)])]),_:1})):g("",!0),"banned"===e.status?(r(),m(Ae,{key:2,type:"danger",size:"small"},{default:c(()=>[...a[18]||(a[18]=[v("已封禁",-1)])]),_:1})):g("",!0)])])])]),_:1}),o(Ne,{label:"会员等级",width:"120"},{default:c(({row:e})=>[o(Ae,{type:Ve(e.level),size:"small"},{default:c(()=>[v(f(ze(e.level)),1)]),_:2},1032,["type"])]),_:1}),o(Ne,{label:"账户余额",width:"120",align:"right"},{default:c(({row:e})=>[u("div",Q,"¥"+f(e.balance||0),1)]),_:1}),o(Ne,{label:"积分",width:"100",align:"right"},{default:c(({row:e})=>[u("div",W,f(e.points||0),1)]),_:1}),o(Ne,{label:"订单数",width:"100",align:"center"},{default:c(({row:e})=>[o(Ee,{type:"primary",onClick:a=>{return l=e,void V.info(`查看用户 ${l.nickname||l.username} 的订单记录`);var l}},{default:c(()=>{var a;return[v(f((null==(a=e.stats)?void 0:a.totalOrders)||0),1)]}),_:2},1032,["onClick"])]),_:1}),o(Ne,{label:"消费金额",width:"120",align:"right"},{default:c(({row:e})=>{var a;return[u("div",X,"¥"+f((null==(a=e.stats)?void 0:a.totalSpent)||0),1)]}),_:1}),o(Ne,{prop:"createTime",label:"注册时间",width:"160"},{default:c(({row:e})=>[v(f(Se(e.createTime)),1)]),_:1}),o(Ne,{label:"最后登录",width:"160"},{default:c(({row:e})=>[v(f(Se(e.lastLoginTime)),1)]),_:1}),o(Ne,{label:"操作",width:"200",fixed:"right"},{default:c(({row:e})=>[o(C,{type:"primary",size:"small",onClick:a=>(async e=>{try{const a=await S(e.id);we.user=a,we.visible=!0}catch(a){V.error("获取用户详情失败"),we.user={...e,addresses:[{id:"addr1",name:"张三",phone:"13800138001",province:"北京市",city:"朝阳区",district:"xxx街道",detail:"xxx小区xxx号楼",isDefault:!0}],coupons:[{id:"c1",name:"新客专享",amount:20,minSpend:100}],recentOrders:[{id:"order1",orderNo:"ORD-2024-001",serviceName:"家庭日常保洁",amount:180,status:"completed",createTime:"2024-01-15 14:00:00"}]},we.visible=!0}})(e)},{default:c(()=>[...a[19]||(a[19]=[v(" 详情 ",-1)])]),_:1},8,["onClick"]),o(C,{type:"success",size:"small",onClick:a=>Ue(e)},{default:c(()=>[...a[20]||(a[20]=[v(" 赠券 ",-1)])]),_:1},8,["onClick"]),"active"===e.status?(r(),m(C,{key:0,type:"danger",size:"small",onClick:a=>(async e=>{try{await z.confirm(`确定要封禁用户 ${e.nickname||e.username} 吗？封禁后用户将无法正常使用系统。`,"封禁确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),V.success("用户已封禁"),Ce()}catch(a){"cancel"!==a&&V.error("封禁失败")}})(e)},{default:c(()=>[...a[21]||(a[21]=[v(" 封禁 ",-1)])]),_:1},8,["onClick"])):(r(),m(C,{key:1,type:"success",size:"small",onClick:a=>(async e=>{try{await z.confirm(`确定要解封用户 ${e.nickname||e.username} 吗？`,"解封确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),V.success("用户已解封"),Ce()}catch(a){"cancel"!==a&&V.error("解封失败")}})(e)},{default:c(()=>[...a[22]||(a[22]=[v(" 解封 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])),[[Ze,ge.value]]),u("div",Y,[o(Ke,{"current-page":fe.page,"onUpdate:currentPage":a[3]||(a[3]=e=>fe.page=e),"page-size":fe.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>fe.pageSize=e),"page-sizes":fe.pageSizes,total:fe.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:De,onCurrentChange:je},null,8,["current-page","page-size","page-sizes","total"])])]),o(Qe,{modelValue:we.visible,"onUpdate:modelValue":a[5]||(a[5]=e=>we.visible=e),title:`用户详情 - ${(null==(l=we.user)?void 0:l.nickname)||(null==(t=we.user)?void 0:t.username)}`,width:"900px"},{default:c(()=>[we.user?(r(),d("div",Z,[o(He,{gutter:24},{default:c(()=>[o(Ge,{span:16},{default:c(()=>[o(Fe,{title:"基本信息",column:2,border:""},{default:c(()=>[o(Re,{label:"用户名"},{default:c(()=>[v(f(we.user.username),1)]),_:1}),o(Re,{label:"昵称"},{default:c(()=>[v(f(we.user.nickname||"未设置"),1)]),_:1}),o(Re,{label:"手机号"},{default:c(()=>[v(f(we.user.phone),1)]),_:1}),o(Re,{label:"会员等级"},{default:c(()=>[o(Ae,{type:Ve(we.user.level)},{default:c(()=>[v(f(ze(we.user.level)),1)]),_:1},8,["type"])]),_:1}),o(Re,{label:"账户余额"},{default:c(()=>[v("¥"+f(we.user.balance||0),1)]),_:1}),o(Re,{label:"积分"},{default:c(()=>[v(f(we.user.points||0),1)]),_:1}),o(Re,{label:"状态"},{default:c(()=>[o(Ae,{type:"active"===we.user.status?"success":"danger"},{default:c(()=>[v(f("active"===we.user.status?"正常":"已封禁"),1)]),_:1},8,["type"])]),_:1}),o(Re,{label:"注册时间"},{default:c(()=>[v(f(Se(we.user.createTime)),1)]),_:1}),o(Re,{label:"最后登录"},{default:c(()=>[v(f(Se(we.user.lastLoginTime)),1)]),_:1})]),_:1}),o(Fe,{title:"消费统计",column:2,border:"",style:{"margin-top":"20px"}},{default:c(()=>[o(Re,{label:"总订单数"},{default:c(()=>{var e;return[v(f((null==(e=we.user.stats)?void 0:e.totalOrders)||0),1)]}),_:1}),o(Re,{label:"总消费金额"},{default:c(()=>{var e;return[v("¥"+f((null==(e=we.user.stats)?void 0:e.totalSpent)||0),1)]}),_:1}),o(Re,{label:"平均客单价"},{default:c(()=>{var e;return[v("¥"+f((null==(e=we.user.stats)?void 0:e.avgOrderValue)||0),1)]}),_:1}),o(Re,{label:"最近消费"},{default:c(()=>{var e;return[v(f(Se(null==(e=we.user.stats)?void 0:e.lastOrderTime)||"无"),1)]}),_:1})]),_:1})]),_:1}),o(Ge,{span:8},{default:c(()=>[o(Be,{title:"账户概览",class:"account-card"},{default:c(()=>{var e;return[u("div",ee,[u("div",ae,[a[23]||(a[23]=u("div",{class:"account-label"},"余额",-1)),u("div",le,"¥"+f(we.user.balance||0),1)]),u("div",te,[a[24]||(a[24]=u("div",{class:"account-label"},"积分",-1)),u("div",se,f(we.user.points||0),1)]),u("div",ie,[a[25]||(a[25]=u("div",{class:"account-label"},"优惠券",-1)),u("div",ne,f((null==(e=we.user.coupons)?void 0:e.length)||0)+" 张",1)])])]}),_:1})]),_:1})]),_:1}),we.user.addresses?(r(),d("div",re,[u("h4",null,"收货地址 ("+f(we.user.addresses.length)+")",1),u("div",de,[(r(!0),d(_,null,h(we.user.addresses,e=>(r(),d("div",{key:e.id,class:"address-item"},[u("div",ue,[u("div",oe,[u("span",ce,f(e.name),1),u("span",pe,f(e.phone),1),e.isDefault?(r(),m(Ae,{key:0,type:"primary",size:"small"},{default:c(()=>[...a[26]||(a[26]=[v("默认",-1)])]),_:1})):g("",!0)]),u("div",ve,f(e.province)+f(e.city)+f(e.district)+f(e.detail),1)])]))),128))])])):g("",!0),we.user.recentOrders?(r(),d("div",me,[a[27]||(a[27]=u("h4",null,"最近订单",-1)),o(Je,{data:we.user.recentOrders,size:"small"},{default:c(()=>[o(Ne,{prop:"orderNo",label:"订单号",width:"150"}),o(Ne,{prop:"serviceName",label:"服务"}),o(Ne,{prop:"amount",label:"金额",width:"100",align:"right"},{default:c(({row:e})=>[v("¥"+f(e.amount),1)]),_:1}),o(Ne,{prop:"status",label:"状态",width:"100"},{default:c(({row:e})=>{return[o(Ae,{type:(a=e.status,{pending:"warning",accepted:"primary",in_service:"success",completed:"success",cancelled:"danger"}[a]||"info"),size:"small"},{default:c(()=>[v(f(xe(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),o(Ne,{prop:"createTime",label:"时间",width:"160"},{default:c(({row:e})=>[v(f(Se(e.createTime)),1)]),_:1})]),_:1},8,["data"])])):g("",!0)])):g("",!0)]),_:1},8,["modelValue","title"]),o(Qe,{modelValue:ke.visible,"onUpdate:modelValue":a[10]||(a[10]=e=>ke.visible=e),title:`赠送优惠券 - ${(null==(s=ke.user)?void 0:s.nickname)||(null==(x=ke.user)?void 0:x.username)}`,width:"500px","close-on-click-modal":!1},{footer:c(()=>[o(C,{onClick:a[9]||(a[9]=e=>ke.visible=!1)},{default:c(()=>[...a[28]||(a[28]=[v("取消",-1)])]),_:1}),o(C,{type:"primary",loading:ke.loading,onClick:$e},{default:c(()=>[...a[29]||(a[29]=[v(" 确认赠送 ",-1)])]),_:1},8,["loading"])]),default:c(()=>[o(Ye,{model:ke.form,"label-width":"100px"},{default:c(()=>[o(We,{label:"优惠券类型"},{default:c(()=>[o(qe,{modelValue:ke.form.couponId,"onUpdate:modelValue":a[6]||(a[6]=e=>ke.form.couponId=e),placeholder:"选择优惠券",style:{width:"100%"}},{default:c(()=>[(r(!0),d(_,null,h(_e.value,e=>(r(),m(Le,{key:e.id,label:`${e.name} - ¥${e.amount} (满${e.minSpend}可用)`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(We,{label:"赠送数量"},{default:c(()=>[o(Xe,{modelValue:ke.form.quantity,"onUpdate:modelValue":a[7]||(a[7]=e=>ke.form.quantity=e),min:1,max:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(We,{label:"备注"},{default:c(()=>[o(T,{modelValue:ke.form.remark,"onUpdate:modelValue":a[8]||(a[8]=e=>ke.form.remark=e),type:"textarea",placeholder:"可选，填写赠送原因",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-27c36063"]]);export{fe as default};
