import{b as a,G as e,u as l,N as t,E as s,f as n}from"./element-ca729cb6.js";import{g as i,p as d,_ as r}from"./index-30b3d731.js";import{v as o,r as u,k as c,l as v,ak as p,aq as m,y as f,B as h,E as b,C as g,D as w,u as _,O as y,M as k,J as I,z as N,L as z,n as C}from"./vendor-60cd9ffe.js";const x={class:"finance-page"},V={class:"stats-grid"},j={class:"stat-content"},S={class:"stat-icon income"},P={class:"stat-info"},$={class:"stat-value"},T={class:"stat-content"},U={class:"stat-icon pending"},A={class:"stat-info"},L={class:"stat-value"},B={class:"stat-content"},D={class:"stat-icon providers"},M={class:"stat-info"},W={class:"stat-value"},q={class:"stat-content"},E={class:"stat-icon today"},R={class:"stat-info"},G={class:"stat-value"},H={class:"chart-header"},J={class:"card-header"},O={class:"header-actions"},F={class:"provider-info"},K={class:"provider-name"},Q={class:"provider-phone"},X={class:"amount"},Y={class:"bank-info"},Z={class:"pagination-container"},aa={key:0,class:"withdrawal-detail"},ea={key:0,class:"reject-reason"},la=r(o({__name:"index",setup(r){const o=u({totalIncome:0,pendingWithdrawals:0,activeProviders:0,todayIncome:0}),la=u({labels:[],values:[]}),ta=u("week"),sa=u(),na=u([]),ia=u(!1),da=u(""),ra=u(null),oa=u(!1),ua=c({page:1,pageSize:20,total:0}),ca=c({visible:!1,loading:!1,withdrawalId:"",form:{reason:""}}),va=async()=>{try{const a=await i("/dashboard/stats");o.value=a}catch(a){s.error("获取财务统计失败"),o.value={totalIncome:528900,pendingWithdrawals:8,activeProviders:156,todayIncome:3250}}},pa=async()=>{try{const e=await(a={range:ta.value},i("/dashboard/charts",a));la.value=e,ma()}catch(e){s.error("获取图表数据失败"),la.value={labels:["周一","周二","周三","周四","周五","周六","周日"],values:[1200,1900,1500,2500,2200,3e3,2800]},ma()}var a},ma=()=>{C(()=>{if(sa.value){const a=sa.value,e=Math.max(...la.value.values);a.innerHTML=`\n        <div class="simple-chart">\n          <div class="chart-bars">\n            ${la.value.labels.map((a,l)=>`\n              <div class="chart-bar-wrapper">\n                <div class="chart-bar" style="height: ${la.value.values[l]/e*200}px"></div>\n                <div class="chart-label">${a}</div>\n                <div class="chart-value">¥${la.value.values[l]}</div>\n              </div>\n            `).join("")}\n          </div>\n        </div>\n      `}})},fa=async()=>{ia.value=!0;try{const a={page:ua.page,pageSize:ua.pageSize,status:da.value||void 0},e=await(a=>i("/finance/withdrawals",a))(a);na.value=e.list,ua.total=e.total}catch(a){s.error("获取提现列表失败"),na.value=[{id:1,providerName:"王阿姨",providerPhone:"13800138001",withdrawalAmount:500,status:"pending",applyTime:"2024-01-20 10:30:00",bankInfo:{bankName:"中国工商银行",cardNumber:"6222********1234",branchName:"北京朝阳支行",accountName:"王秀英"}},{id:2,providerName:"李师傅",providerPhone:"13800138002",withdrawalAmount:800,status:"approved",applyTime:"2024-01-19 15:20:00",bankInfo:{bankName:"中国建设银行",cardNumber:"6217********5678",branchName:"上海浦东支行",accountName:"李建国"}}],ua.total=2}finally{ia.value=!1}},ha=async a=>{try{await n.confirm(`确定要通过 ${a.providerName} 的提现申请 ¥${a.withdrawalAmount} 吗？`,"确认通过",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await(e=a.id,d(`/finance/withdrawals/${e}/audit`,{action:"approve"})),s.success("提现已通过"),fa(),va()}catch(l){"cancel"!==l&&s.error("操作失败")}var e},ba=async()=>{if(ca.form.reason.trim()){ca.loading=!0;try{await(a=ca.withdrawalId,e={reason:ca.form.reason},d(`/finance/withdrawals/${a}/audit`,{action:"reject",...e})),s.success("提现已拒绝"),ca.visible=!1,fa(),va()}catch(l){s.error("操作失败")}finally{ca.loading=!1}var a,e}else s.warning("请输入拒绝原因")},ga=a=>({pending:"warning",approved:"success",rejected:"danger"}[a]||"info"),wa=a=>({pending:"待审核",approved:"已通过",rejected:"已拒绝"}[a]||a),_a=a=>{ua.page=a,fa()},ya=a=>{ua.pageSize=a,ua.page=1,fa()};return v(()=>{va(),pa(),fa()}),(s,n)=>{const i=p("el-icon"),d=p("el-card"),r=p("el-option"),u=p("el-select"),c=p("el-button"),v=p("el-table-column"),C=p("el-tag"),la=p("el-table"),va=p("el-pagination"),ma=p("el-descriptions-item"),ka=p("el-descriptions"),Ia=p("el-dialog"),Na=p("el-input"),za=p("el-form-item"),Ca=p("el-form"),xa=m("loading");return f(),h("div",x,[b("div",V,[g(d,{class:"stat-card"},{default:w(()=>{var e;return[b("div",j,[b("div",S,[g(i,null,{default:w(()=>[g(_(a))]),_:1})]),b("div",P,[b("div",$,y((null==(e=o.value.totalIncome)?void 0:e.toLocaleString())||0),1),n[8]||(n[8]=b("div",{class:"stat-label"},"总收入 (元)",-1))])])]}),_:1}),g(d,{class:"stat-card"},{default:w(()=>[b("div",T,[b("div",U,[g(i,null,{default:w(()=>[g(_(e))]),_:1})]),b("div",A,[b("div",L,y(o.value.pendingWithdrawals||0),1),n[9]||(n[9]=b("div",{class:"stat-label"},"待提现笔数",-1))])])]),_:1}),g(d,{class:"stat-card"},{default:w(()=>[b("div",B,[b("div",D,[g(i,null,{default:w(()=>[g(_(l))]),_:1})]),b("div",M,[b("div",W,y(o.value.activeProviders||0),1),n[10]||(n[10]=b("div",{class:"stat-label"},"活跃服务者",-1))])])]),_:1}),g(d,{class:"stat-card"},{default:w(()=>{var a;return[b("div",q,[b("div",E,[g(i,null,{default:w(()=>[g(_(t))]),_:1})]),b("div",R,[b("div",G,y((null==(a=o.value.todayIncome)?void 0:a.toLocaleString())||0),1),n[11]||(n[11]=b("div",{class:"stat-label"},"今日收入 (元)",-1))])])]}),_:1})]),g(d,{class:"chart-card"},{header:w(()=>[b("div",H,[n[12]||(n[12]=b("span",null,"收入趋势",-1)),g(u,{modelValue:ta.value,"onUpdate:modelValue":n[0]||(n[0]=a=>ta.value=a),size:"small",style:{width:"120px"},onChange:pa},{default:w(()=>[g(r,{label:"本周",value:"week"}),g(r,{label:"本月",value:"month"}),g(r,{label:"本年",value:"year"})]),_:1},8,["modelValue"])])]),default:w(()=>[b("div",{ref_key:"chartContainer",ref:sa,class:"chart-container"},null,512)]),_:1}),g(d,{class:"withdrawal-card"},{header:w(()=>[b("div",J,[n[14]||(n[14]=b("span",null,"提现审核",-1)),b("div",O,[g(u,{modelValue:da.value,"onUpdate:modelValue":n[1]||(n[1]=a=>da.value=a),placeholder:"筛选状态",style:{width:"120px"},onChange:fa},{default:w(()=>[g(r,{label:"全部",value:""}),g(r,{label:"待审核",value:"pending"}),g(r,{label:"已通过",value:"approved"}),g(r,{label:"已拒绝",value:"rejected"})]),_:1},8,["modelValue"]),g(c,{onClick:fa,loading:ia.value},{default:w(()=>[...n[13]||(n[13]=[k("刷新",-1)])]),_:1},8,["loading"])])])]),default:w(()=>[I((f(),N(la,{data:na.value,stripe:""},{default:w(()=>[g(v,{prop:"id",label:"ID",width:"80"}),g(v,{label:"服务者信息","min-width":"200"},{default:w(({row:a})=>[b("div",F,[b("div",K,y(a.providerName),1),b("div",Q,y(a.providerPhone),1)])]),_:1}),g(v,{prop:"withdrawalAmount",label:"提现金额",width:"120",align:"center"},{default:w(({row:a})=>[b("div",X,"¥"+y(a.withdrawalAmount),1)]),_:1}),g(v,{prop:"bankInfo",label:"银行卡信息","min-width":"200"},{default:w(({row:a})=>[b("div",Y,[b("div",null,y(a.bankInfo.bankName),1),b("div",null,y(a.bankInfo.cardNumber),1)])]),_:1}),g(v,{prop:"status",label:"状态",width:"100",align:"center"},{default:w(({row:a})=>[g(C,{type:ga(a.status)},{default:w(()=>[k(y(wa(a.status)),1)]),_:2},1032,["type"])]),_:1}),g(v,{prop:"applyTime",label:"申请时间",width:"180"}),g(v,{label:"操作",width:"200",fixed:"right"},{default:w(({row:a})=>["pending"===a.status?(f(),N(c,{key:0,link:"",type:"success",size:"small",onClick:e=>ha(a)},{default:w(()=>[...n[15]||(n[15]=[k(" 通过 ",-1)])]),_:1},8,["onClick"])):z("",!0),"pending"===a.status?(f(),N(c,{key:1,link:"",type:"danger",size:"small",onClick:e=>{return l=a,ca.withdrawalId=l.id,ca.form.reason="",void(ca.visible=!0);var l}},{default:w(()=>[...n[16]||(n[16]=[k(" 拒绝 ",-1)])]),_:1},8,["onClick"])):z("",!0),g(c,{link:"",type:"primary",size:"small",onClick:e=>{return l=a,ra.value=l,void(oa.value=!0);var l}},{default:w(()=>[...n[17]||(n[17]=[k(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[xa,ia.value]]),b("div",Z,[g(va,{"current-page":ua.page,"onUpdate:currentPage":n[2]||(n[2]=a=>ua.page=a),"page-size":ua.pageSize,"onUpdate:pageSize":n[3]||(n[3]=a=>ua.pageSize=a),"page-sizes":[10,20,50],total:ua.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ya,onCurrentChange:_a},null,8,["current-page","page-size","total"])])]),_:1}),g(Ia,{modelValue:oa.value,"onUpdate:modelValue":n[4]||(n[4]=a=>oa.value=a),title:"提现详情",width:"600px"},{default:w(()=>[ra.value?(f(),h("div",aa,[g(ka,{column:2,border:""},{default:w(()=>[g(ma,{label:"申请ID"},{default:w(()=>[k(y(ra.value.id),1)]),_:1}),g(ma,{label:"状态"},{default:w(()=>[g(C,{type:ga(ra.value.status)},{default:w(()=>[k(y(wa(ra.value.status)),1)]),_:1},8,["type"])]),_:1}),g(ma,{label:"服务者姓名"},{default:w(()=>[k(y(ra.value.providerName),1)]),_:1}),g(ma,{label:"联系电话"},{default:w(()=>[k(y(ra.value.providerPhone),1)]),_:1}),g(ma,{label:"提现金额"},{default:w(()=>[k("¥"+y(ra.value.withdrawalAmount),1)]),_:1}),g(ma,{label:"申请时间"},{default:w(()=>[k(y(ra.value.applyTime),1)]),_:1}),g(ma,{label:"银行名称",span:"2"},{default:w(()=>[k(y(ra.value.bankInfo.bankName),1)]),_:1}),g(ma,{label:"银行卡号",span:"2"},{default:w(()=>[k(y(ra.value.bankInfo.cardNumber),1)]),_:1}),g(ma,{label:"开户行",span:"2"},{default:w(()=>[k(y(ra.value.bankInfo.branchName),1)]),_:1}),g(ma,{label:"持卡人姓名",span:"2"},{default:w(()=>[k(y(ra.value.bankInfo.accountName),1)]),_:1})]),_:1}),ra.value.rejectReason?(f(),h("div",ea,[n[18]||(n[18]=b("h4",null,"拒绝原因",-1)),b("p",null,y(ra.value.rejectReason),1)])):z("",!0)])):z("",!0)]),_:1},8,["modelValue"]),g(Ia,{modelValue:ca.visible,"onUpdate:modelValue":n[7]||(n[7]=a=>ca.visible=a),title:"拒绝提现",width:"500px"},{footer:w(()=>[g(c,{onClick:n[6]||(n[6]=a=>ca.visible=!1)},{default:w(()=>[...n[19]||(n[19]=[k("取消",-1)])]),_:1}),g(c,{type:"danger",loading:ca.loading,onClick:ba},{default:w(()=>[...n[20]||(n[20]=[k(" 确认拒绝 ",-1)])]),_:1},8,["loading"])]),default:w(()=>[g(Ca,{model:ca.form,"label-width":"100px"},{default:w(()=>[g(za,{label:"拒绝原因",required:""},{default:w(()=>[g(Na,{modelValue:ca.form.reason,"onUpdate:modelValue":n[5]||(n[5]=a=>ca.form.reason=a),type:"textarea",rows:4,placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-85a16e3a"]]);export{la as default};
