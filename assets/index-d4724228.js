import{v as e,r as a,k as l,l as t,ak as i,aq as s,y as r,B as o,E as d,C as n,ag as u,u as c,D as m,P as p,a3 as g,z as v,M as f,J as y,L as _,O as b,n as h}from"./vendor-60cd9ffe.js";import{L as w,M as V,E as k,f as I}from"./element-ca729cb6.js";import{g as C,p as z,b as x,d as U,_ as A}from"./index-30b3d731.js";import{g as S}from"./category-deb9b879.js";const j={class:"service-page"},q={class:"toolbar"},F={class:"toolbar-left"},T={class:"toolbar-right"},B={class:"table-container"},N={class:"service-name"},$={class:"service-info"},L={class:"name"},D={class:"tags"},E={class:"price"},K={class:"amount"},M={class:"unit"},O={class:"pagination-container"},P={key:0,class:"service-detail"},J={key:0,class:"service-images"},R=A(e({__name:"index",setup(e){const A=a(),R=a(!1),G=a([]),H=a([]),Q=a(null),W=a(!1),X=l({keyword:"",categoryId:"",status:""}),Y=l({page:1,pageSize:20,total:0}),Z=l({visible:!1,loading:!1,title:"",imageFiles:[],editingServiceId:"",form:{name:"",categoryId:"",price:0,unit:"",images:[],tags:[],description:"",status:"active"}}),ee=a(!1),ae=a(""),le=async()=>{R.value=!0;try{const e={page:Y.page,pageSize:Y.pageSize,keyword:X.keyword||void 0,categoryId:X.categoryId||void 0,status:X.status||void 0},a=await(e=>C("/services",e))(e);let l=[];a&&a.data&&Array.isArray(a.data)?l=a.data:a&&a.list&&Array.isArray(a.list)?l=a.list:Array.isArray(a)?l=a:(k.error("服务数据格式不正确"),l=[]),G.value=l.map(e=>({...e,categoryName:te(e.categoryId)})),Y.total=a.total||l.length}catch(e){k.error("获取服务列表失败"),G.value=[{id:"1",name:"家庭日常保洁",categoryId:"daily_clean",categoryName:"日常保洁",price:45,unit:"小时",images:["https://example.com/service1.jpg"],description:"专业的家庭日常保洁服务",tags:["经验丰富","工具齐全"],status:"active",createTime:"2023-10-01 10:00:00"}],Y.total=1}finally{R.value=!1}},te=e=>{if(!e)return"未分类";if(!Array.isArray(H.value))return"未知分类";const a=H.value.find(a=>a&&a.id===e);return(null==a?void 0:a.name)||"未知分类"},ie=()=>{Y.page=1,le()},se=e=>{Y.page=e,le()},re=e=>{Y.pageSize=e,Y.page=1,le()},oe=()=>{Z.title="新增服务",Z.form={name:"",categoryId:"",price:0,unit:"",images:[],tags:[],description:"",status:"active"},Z.imageFiles=[],Z.visible=!0},de=async()=>{if(Z.form.name&&Z.form.categoryId&&Z.form.unit){Z.loading=!0;try{const a={...Z.form};if("新增服务"===Z.title)await(e=a,z("/services",e)),k.success("创建成功");else{const e=Z.editingServiceId;if(!e)return void k.error("服务ID不能为空");await((e,a)=>x(`/services/${e}`,a))(e,a),k.success("更新成功")}Z.visible=!1,le()}catch(a){k.error("操作失败")}finally{Z.loading=!1}var e}else k.warning("请填写完整信息")},ne=async e=>{try{await ne(e.id,e.status),k.success("状态更新成功")}catch(a){k.error("状态更新失败")}},ue=async e=>{try{await I.confirm(`确定要删除服务 "${e.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await(a=e.id,U(`/services/${a}`)),k.success("删除成功"),le()}catch(l){"cancel"!==l&&k.error("删除失败")}var a},ce=()=>{ee.value=!0,h(()=>{var e;null==(e=A.value)||e.focus()})},me=()=>{const e=ae.value.trim();e&&!Z.form.tags.includes(e)&&Z.form.tags.push(e),ee.value=!1,ae.value=""};return t(()=>{(async()=>{try{const e=await S();let a=[];a=e&&e.data&&Array.isArray(e.data)?e.data:e&&e.list&&Array.isArray(e.list)?e.list:Array.isArray(e)?e:[],H.value=a}catch(e){k.error("获取分类列表失败"),H.value=[{id:"daily_clean",name:"日常保洁",parentId:"cleaning"},{id:"deep_clean",name:"深度保洁",parentId:"cleaning"},{id:"nanny",name:"月嫂服务",parentId:null},{id:"moving",name:"搬家服务",parentId:null}]}})(),le()}),(e,a)=>{const l=i("el-option"),t=i("el-select"),h=i("el-button"),k=i("el-image"),I=i("el-tag"),C=i("el-table-column"),z=i("el-switch"),x=i("el-table"),U=i("el-pagination"),S=i("el-form-item"),te=i("el-col"),pe=i("el-row"),ge=i("el-input-number"),ve=i("el-radio"),fe=i("el-radio-group"),ye=i("el-icon"),_e=i("el-upload"),be=i("el-form"),he=i("el-dialog"),we=i("el-descriptions-item"),Ve=i("el-descriptions"),ke=s("loading");return r(),o("div",j,[d("div",q,[d("div",F,[n(c(w),{modelValue:X.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>X.keyword=e),placeholder:"搜索服务名称",clearable:"",style:{width:"220px"},onClear:ie,onKeyup:u(ie,["enter"])},null,8,["modelValue"]),n(t,{modelValue:X.categoryId,"onUpdate:modelValue":a[1]||(a[1]=e=>X.categoryId=e),placeholder:"选择分类",clearable:"",style:{width:"150px"},onChange:ie},{default:m(()=>[(r(!0),o(p,null,g(H.value,e=>(r(),v(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(t,{modelValue:X.status,"onUpdate:modelValue":a[2]||(a[2]=e=>X.status=e),placeholder:"状态",clearable:"",style:{width:"120px"},onChange:ie},{default:m(()=>[n(l,{label:"已上架",value:"active"}),n(l,{label:"已下架",value:"inactive"})]),_:1},8,["modelValue"]),n(h,{type:"primary",onClick:oe},{default:m(()=>[...a[16]||(a[16]=[f("新增服务",-1)])]),_:1})]),d("div",T,[n(h,{onClick:le,loading:R.value},{default:m(()=>[...a[17]||(a[17]=[f("刷新",-1)])]),_:1},8,["loading"])])]),d("div",B,[y((r(),v(x,{data:G.value,stripe:""},{default:m(()=>[n(C,{prop:"name",label:"服务名称","min-width":"200"},{default:m(({row:e})=>{var a;return[d("div",N,[e.images&&e.images.length>0?(r(),v(k,{key:0,src:e.images[0],"preview-src-list":e.images,fit:"cover",class:"service-image"},null,8,["src","preview-src-list"])):_("",!0),d("div",$,[d("div",L,b(e.name),1),d("div",D,[(r(!0),o(p,null,g(null==(a=e.tags)?void 0:a.slice(0,2),e=>(r(),v(I,{key:e,size:"small",type:"info"},{default:m(()=>[f(b(e),1)]),_:2},1024))),128))])])])]}),_:1}),n(C,{prop:"price",label:"价格",width:"120",align:"center"},{default:m(({row:e})=>[d("div",E,[d("span",K,"¥"+b(e.price),1),d("span",M,"/"+b(e.unit),1)])]),_:1}),n(C,{prop:"categoryName",label:"分类",width:"120",align:"center"}),n(C,{prop:"status",label:"状态",width:"100",align:"center"},{default:m(({row:e})=>[n(z,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"active-value":"active","inactive-value":"inactive",onChange:a=>ne(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),n(C,{prop:"createTime",label:"创建时间",width:"180"}),n(C,{label:"操作",width:"200",fixed:"right"},{default:m(({row:e})=>[n(h,{link:"",type:"primary",size:"small",onClick:a=>{return l=e,Z.title="编辑服务",Z.editingServiceId=l.id,Z.form={name:l.name,categoryId:l.categoryId,price:l.price,unit:l.unit,images:l.images||[],tags:l.tags||[],description:l.description||"",status:l.status},Z.imageFiles=(l.images||[]).map((e,a)=>({name:`image${a}`,url:e})),void(Z.visible=!0);var l}},{default:m(()=>[...a[18]||(a[18]=[f(" 编辑 ",-1)])]),_:1},8,["onClick"]),n(h,{link:"",type:"success",size:"small",onClick:a=>{return l=e,Q.value=l,void(W.value=!0);var l}},{default:m(()=>[...a[19]||(a[19]=[f(" 详情 ",-1)])]),_:1},8,["onClick"]),n(h,{link:"",type:"danger",size:"small",onClick:a=>ue(e)},{default:m(()=>[...a[20]||(a[20]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ke,R.value]]),d("div",O,[n(U,{"current-page":Y.page,"onUpdate:currentPage":a[3]||(a[3]=e=>Y.page=e),"page-size":Y.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>Y.pageSize=e),"page-sizes":[10,20,50],total:Y.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:re,onCurrentChange:se},null,8,["current-page","page-size","total"])])]),n(he,{modelValue:Z.visible,"onUpdate:modelValue":a[14]||(a[14]=e=>Z.visible=e),title:Z.title,width:"800px","close-on-click-modal":!1},{footer:m(()=>[n(h,{onClick:a[13]||(a[13]=e=>Z.visible=!1)},{default:m(()=>[...a[24]||(a[24]=[f("取消",-1)])]),_:1}),n(h,{type:"primary",loading:Z.loading,onClick:de},{default:m(()=>[...a[25]||(a[25]=[f(" 保存 ",-1)])]),_:1},8,["loading"])]),default:m(()=>[n(be,{model:Z.form,"label-width":"100px"},{default:m(()=>[n(pe,{gutter:20},{default:m(()=>[n(te,{span:12},{default:m(()=>[n(S,{label:"服务名称",required:""},{default:m(()=>[n(c(w),{modelValue:Z.form.name,"onUpdate:modelValue":a[5]||(a[5]=e=>Z.form.name=e),placeholder:"请输入服务名称"},null,8,["modelValue"])]),_:1})]),_:1}),n(te,{span:12},{default:m(()=>[n(S,{label:"所属分类",required:""},{default:m(()=>[n(t,{modelValue:Z.form.categoryId,"onUpdate:modelValue":a[6]||(a[6]=e=>Z.form.categoryId=e),placeholder:"选择分类",style:{width:"100%"}},{default:m(()=>[(r(!0),o(p,null,g(H.value,e=>(r(),v(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(pe,{gutter:20},{default:m(()=>[n(te,{span:8},{default:m(()=>[n(S,{label:"价格",required:""},{default:m(()=>[n(ge,{modelValue:Z.form.price,"onUpdate:modelValue":a[7]||(a[7]=e=>Z.form.price=e),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),n(te,{span:8},{default:m(()=>[n(S,{label:"计价单位",required:""},{default:m(()=>[n(c(w),{modelValue:Z.form.unit,"onUpdate:modelValue":a[8]||(a[8]=e=>Z.form.unit=e),placeholder:"如：小时、次"},null,8,["modelValue"])]),_:1})]),_:1}),n(te,{span:8},{default:m(()=>[n(S,{label:"状态"},{default:m(()=>[n(fe,{modelValue:Z.form.status,"onUpdate:modelValue":a[9]||(a[9]=e=>Z.form.status=e)},{default:m(()=>[n(ve,{label:"active"},{default:m(()=>[...a[21]||(a[21]=[f("上架",-1)])]),_:1}),n(ve,{label:"inactive"},{default:m(()=>[...a[22]||(a[22]=[f("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(S,{label:"服务图片"},{default:m(()=>[n(_e,{"file-list":Z.imageFiles,"onUpdate:fileList":a[10]||(a[10]=e=>Z.imageFiles=e),"auto-upload":!1,"list-type":"picture-card",limit:5},{default:m(()=>[n(ye,null,{default:m(()=>[n(c(V))]),_:1})]),_:1},8,["file-list"])]),_:1}),n(S,{label:"服务标签"},{default:m(()=>[(r(!0),o(p,null,g(Z.form.tags,e=>(r(),v(I,{key:e,closable:"",onClose:a=>(e=>{const a=Z.form.tags.indexOf(e);a>-1&&Z.form.tags.splice(a,1)})(e),style:{"margin-right":"8px"}},{default:m(()=>[f(b(e),1)]),_:2},1032,["onClose"]))),128)),ee.value?(r(),v(c(w),{key:0,ref_key:"tagInputRef",ref:A,modelValue:ae.value,"onUpdate:modelValue":a[11]||(a[11]=e=>ae.value=e),size:"small",style:{width:"100px"},onKeyup:u(me,["enter"]),onBlur:me},null,8,["modelValue"])):(r(),v(h,{key:1,size:"small",onClick:ce},{default:m(()=>[...a[23]||(a[23]=[f("+ 添加标签",-1)])]),_:1}))]),_:1}),n(S,{label:"服务描述"},{default:m(()=>[n(c(w),{modelValue:Z.form.description,"onUpdate:modelValue":a[12]||(a[12]=e=>Z.form.description=e),type:"textarea",rows:4,placeholder:"请输入服务描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),n(he,{modelValue:W.value,"onUpdate:modelValue":a[15]||(a[15]=e=>W.value=e),title:"服务详情",width:"600px"},{default:m(()=>[Q.value?(r(),o("div",P,[n(Ve,{column:2,border:""},{default:m(()=>[n(we,{label:"服务名称"},{default:m(()=>[f(b(Q.value.name),1)]),_:1}),n(we,{label:"价格"},{default:m(()=>[f("¥"+b(Q.value.price)+"/"+b(Q.value.unit),1)]),_:1}),n(we,{label:"分类"},{default:m(()=>[f(b(Q.value.categoryName),1)]),_:1}),n(we,{label:"状态"},{default:m(()=>[n(I,{type:"active"===Q.value.status?"success":"danger"},{default:m(()=>[f(b("active"===Q.value.status?"已上架":"已下架"),1)]),_:1},8,["type"])]),_:1}),n(we,{label:"创建时间",span:"2"},{default:m(()=>[f(b(Q.value.createTime),1)]),_:1}),n(we,{label:"服务描述",span:"2"},{default:m(()=>[f(b(Q.value.description),1)]),_:1}),n(we,{label:"服务标签",span:"2"},{default:m(()=>[(r(!0),o(p,null,g(Q.value.tags,e=>(r(),v(I,{key:e,size:"small",style:{"margin-right":"8px"}},{default:m(()=>[f(b(e),1)]),_:2},1024))),128))]),_:1})]),_:1}),Q.value.images&&Q.value.images.length>0?(r(),o("div",J,[a[26]||(a[26]=d("h4",null,"服务图片",-1)),(r(!0),o(p,null,g(Q.value.images,(e,a)=>(r(),v(k,{key:a,src:e,"preview-src-list":Q.value.images,fit:"cover",class:"detail-image"},null,8,["src","preview-src-list"]))),128))])):_("",!0)])):_("",!0)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-c49d136c"]]);export{R as default};
