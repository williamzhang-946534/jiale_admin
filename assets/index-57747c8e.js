import{v as e,k as a,r as l,l as t,ak as i,aq as o,y as n,B as r,E as s,C as d,D as p,u,M as c,ag as m,P as g,a3 as f,J as v,z as b,O as h,L as y}from"./vendor-60cd9ffe.js";import{v as C,x as _,E as w}from"./element-ca729cb6.js";import{u as z,f as k,a as V}from"./formatDate-ce0a9b4f.js";import{g as j,b as x,c as S}from"./provider-12b388c0.js";import{_ as U}from"./index-30b3d731.js";const A={class:"provider-list"},B={class:"toolbar"},P={class:"toolbar-left"},$={class:"toolbar-right"},D={class:"table-container"},E={class:"pagination-container"},q=U(e({__name:"index",setup(e){const{confirm:U}=V(),{pagination:q,handleSizeChange:F,handleCurrentChange:I,resetPagination:J}=z(),K=a({page:1,pageSize:20,status:void 0,name:""}),L=[{label:"待审核",value:"pending"},{label:"已通过",value:"verified"},{label:"已拒绝",value:"rejected"},{label:"已封禁",value:"banned"}],M=l(!1),O=l([]),R=l([]),G=a({visible:!1,provider:null,form:{action:"approve",reason:""},loading:!1}),H=e=>({unverified:"未认证",pending:"待审核",verified:"已通过",rejected:"已拒绝",banned:"已封禁"}[e]||"未知"),N=async()=>{M.value=!0;try{const e={...K,page:q.page,pageSize:q.pageSize},a=await j(e);O.value=a.items,q.total=a.total}catch(e){w.error("获取服务者列表失败"),O.value=[{id:"1",name:"张三",phone:"13800138001",status:"pending",rating:4.5,serviceCount:25,createdAt:"2024-01-15 10:30:00",updatedAt:"2024-01-15 10:30:00"},{id:"2",name:"李四",phone:"13800138002",status:"verified",rating:4.8,serviceCount:45,createdAt:"2024-01-10 14:20:00",updatedAt:"2024-01-10 14:20:00"}],q.total=2}finally{M.value=!1}},Q=()=>{q.page=1,N()},T=()=>{N()},W=e=>{R.value=e},X=(e,a)=>{G.provider=e,G.form.action=a,G.form.reason="",G.visible=!0},Y=async()=>{if(G.provider){G.loading=!0;try{const e={action:G.form.action,rejectReason:G.form.reason||""};await x(G.provider.id,e),w.success("审核完成"),G.visible=!1,N()}catch(e){w.error("审核失败")}finally{G.loading=!1}}};return t(()=>{N()}),(e,a)=>{var l;const t=i("el-button"),z=i("el-input"),V=i("el-option"),j=i("el-select"),x=i("el-table-column"),J=i("el-tag"),R=i("el-table"),Z=i("el-pagination"),ee=i("el-radio"),ae=i("el-radio-group"),le=i("el-form-item"),te=i("el-form"),ie=i("el-dialog"),oe=o("permission"),ne=o("loading");return n(),r("div",A,[s("div",B,[s("div",P,[d(t,{type:"primary",onClick:T},{default:p(()=>[d(u(C)),a[8]||(a[8]=c(" 刷新 ",-1))]),_:1})]),s("div",$,[d(z,{modelValue:K.name,"onUpdate:modelValue":a[0]||(a[0]=e=>K.name=e),placeholder:"搜索服务者姓名",style:{width:"200px"},clearable:"",onClear:Q,onKeyup:m(Q,["enter"])},{prefix:p(()=>[d(u(_))]),_:1},8,["modelValue"]),d(j,{modelValue:K.status,"onUpdate:modelValue":a[1]||(a[1]=e=>K.status=e),placeholder:"选择状态",style:{width:"120px"},clearable:"",onChange:Q},{default:p(()=>[(n(),r(g,null,f(L,e=>d(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])]),s("div",D,[v((n(),b(R,{data:O.value,stripe:"",style:{width:"100%"},onSelectionChange:W},{default:p(()=>[d(x,{type:"selection",width:"55"}),d(x,{prop:"name",label:"姓名",width:"120"}),d(x,{prop:"phone",label:"联系电话",width:"140"}),d(x,{label:"状态",width:"100"},{default:p(({row:e})=>{return[d(J,{type:(a=e.status,{unverified:"info",pending:"warning",verified:"success",rejected:"danger",banned:"danger"}[a]||"info"),size:"small"},{default:p(()=>[c(h(H(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),d(x,{prop:"rating",label:"评分",width:"80"},{default:p(({row:e})=>[s("span",null,h(e.rating.toFixed(1)),1)]),_:1}),d(x,{prop:"serviceCount",label:"服务次数",width:"100"}),d(x,{prop:"createdAt",label:"注册时间",width:"160"},{default:p(({row:e})=>[c(h(u(k)(e.createdAt)),1)]),_:1}),d(x,{label:"操作",width:"200",fixed:"right"},{default:p(({row:e})=>["pending"===e.status?v((n(),b(t,{key:0,type:"success",size:"small",onClick:a=>X(e,"approve")},{default:p(()=>[...a[9]||(a[9]=[c(" 通过 ",-1)])]),_:1},8,["onClick"])),[[oe,["provider:audit"]]]):y("",!0),"pending"===e.status?v((n(),b(t,{key:1,type:"danger",size:"small",onClick:a=>X(e,"reject")},{default:p(()=>[...a[10]||(a[10]=[c(" 拒绝 ",-1)])]),_:1},8,["onClick"])),[[oe,["provider:audit"]]]):y("",!0),"verified"===e.status?v((n(),b(t,{key:2,type:"warning",size:"small",onClick:a=>(async e=>{if(await U({message:`确定要封禁服务者 ${e.name} 吗？`,type:"warning"}))try{await S(e.id,!e.isBanned),w.success(e.isBanned?"解封成功":"封禁成功"),N()}catch(a){w.error(e.isBanned?"解封失败":"封禁失败")}})(e)},{default:p(()=>[...a[11]||(a[11]=[c(" 封禁 ",-1)])]),_:1},8,["onClick"])),[[oe,["provider:ban"]]]):y("",!0),d(t,{type:"primary",size:"small",onClick:a=>{return l=e,void w.info(`查看服务者 ${l.name} 的详情`);var l}},{default:p(()=>[...a[12]||(a[12]=[c(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,M.value]]),s("div",E,[d(Z,{"current-page":u(q).page,"onUpdate:currentPage":a[2]||(a[2]=e=>u(q).page=e),"page-size":u(q).pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>u(q).pageSize=e),"page-sizes":u(q).pageSizes,total:u(q).total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:u(F),onCurrentChange:u(I)},null,8,["current-page","page-size","page-sizes","total","onSizeChange","onCurrentChange"])])]),d(ie,{modelValue:G.visible,"onUpdate:modelValue":a[7]||(a[7]=e=>G.visible=e),title:`审核服务者 - ${null==(l=G.provider)?void 0:l.name}`,width:"500px"},{footer:p(()=>[d(t,{onClick:a[6]||(a[6]=e=>G.visible=!1)},{default:p(()=>[...a[15]||(a[15]=[c("取消",-1)])]),_:1}),d(t,{type:"primary",onClick:Y,loading:G.loading},{default:p(()=>[...a[16]||(a[16]=[c(" 确定 ",-1)])]),_:1},8,["loading"])]),default:p(()=>[d(te,{model:G.form,"label-width":"80px"},{default:p(()=>[d(le,{label:"审核结果"},{default:p(()=>[d(ae,{modelValue:G.form.action,"onUpdate:modelValue":a[4]||(a[4]=e=>G.form.action=e)},{default:p(()=>[d(ee,{label:"approve"},{default:p(()=>[...a[13]||(a[13]=[c("通过",-1)])]),_:1}),d(ee,{label:"reject"},{default:p(()=>[...a[14]||(a[14]=[c("拒绝",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"reject"===G.form.action?(n(),b(le,{key:0,label:"拒绝原因"},{default:p(()=>[d(z,{modelValue:G.form.reason,"onUpdate:modelValue":a[5]||(a[5]=e=>G.form.reason=e),type:"textarea",placeholder:"请输入拒绝原因",rows:3},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-0baf4753"]]);export{q as default};
