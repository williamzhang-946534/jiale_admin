import{v as e,r as a,c as l,w as s,ak as n,y as i,B as o,C as r,D as u,P as t,a3 as d,u as m,z as c,E as v,O as p,M as f,l as g,aq as _,ag as b,J as w,L as y}from"./vendor-60cd9ffe.js";import{_ as k}from"./index-30b3d731.js";import{f as V,E as h}from"./element-ca729cb6.js";const C={USER:"user",ORDER:"order",PROVIDER:"provider",FINANCE:"finance",MARKETING:"marketing",SYSTEM:"system",LOG:"log"},x={VIEW:"view",CREATE:"create",EDIT:"edit",DELETE:"delete",AUDIT:"audit",BAN:"ban",ASSIGN:"assign",REFUND:"refund",MANAGE:"manage",EXPORT:"export"},E={user:{name:"用户管理",permissions:["user:view","user:create","user:edit","user:delete","user:give_coupon"]},order:{name:"订单管理",permissions:["order:view","order:assign","order:refund","order:export"]},provider:{name:"服务者管理",permissions:["provider:view","provider:audit","provider:ban","provider:edit"]},finance:{name:"财务管理",permissions:["finance:view","finance:audit_withdrawal","finance:export"]},marketing:{name:"营销管理",permissions:["marketing:manage_banner","marketing:manage_coupon"]},system:{name:"系统管理",permissions:["system:manage_role","system:manage_admin","system:view_log","system:use_generator"]}},U={super_admin:{name:"超级管理员",desc:"拥有系统所有权限",permissions:["*"]},admin:{name:"系统管理员",desc:"管理系统配置和用户",permissions:["user:view","user:create","user:edit","system:manage_role","system:manage_admin","system:view_log"]},operator:{name:"运营专员",desc:"负责日常业务操作",permissions:["user:view","user:give_coupon","order:view","order:assign","provider:view","provider:audit"]},finance:{name:"财务专员",desc:"负责财务相关操作",permissions:["finance:view","finance:audit_withdrawal","order:view","order:refund"]},marketer:{name:"营销专员",desc:"负责营销活动管理",permissions:["marketing:manage_banner","marketing:manage_coupon","user:view"]},viewer:{name:"只读用户",desc:"仅可查看数据",permissions:["user:view","order:view","provider:view","finance:view"]}},R={class:"permission-selector"},I={class:"permission-grid"},O={class:"permission-summary"},z={class:"selected-tags"},j={class:"quick-actions"},A=k(e({__name:"PermissionSelector",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:g}){const _=e,b=g,w=a("user"),y=a(""),k=E,V=U,h=l({get:()=>_.modelValue,set:e=>b("update:modelValue",e)}),C=e=>{const[a,l]=e.split(":");return`${{view:"查看",create:"创建",edit:"编辑",delete:"删除",audit:"审核",ban:"封禁",assign:"指派",refund:"退款",manage:"管理",export:"导出",give_coupon:"赠送优惠券",audit_withdrawal:"审核提现",manage_banner:"管理轮播图",manage_coupon:"管理优惠券",manage_role:"管理角色",manage_admin:"管理管理员",view_log:"查看日志",use_generator:"使用代码生成器"}[l]||l}`},x=()=>{const e=k[w.value];if(e){const a=new Set(h.value);e.permissions.forEach(e=>a.add(e)),h.value=Array.from(a)}},A=()=>{h.value=[]};return s(w,e=>{}),(e,a)=>{const l=n("el-checkbox"),s=n("el-checkbox-group"),g=n("el-tab-pane"),_=n("el-tabs"),b=n("el-tag"),E=n("el-button"),U=n("el-option"),T=n("el-select");return i(),o("div",R,[r(_,{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=e=>w.value=e),type:"card"},{default:u(()=>[(i(!0),o(t,null,d(m(k),(e,n)=>(i(),c(g,{key:n,label:e.name,name:n},{default:u(()=>[r(s,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=e=>h.value=e)},{default:u(()=>[v("div",I,[(i(!0),o(t,null,d(e.permissions,e=>(i(),c(l,{key:e,value:e,label:C(e)},null,8,["value","label"]))),128))])]),_:2},1032,["modelValue"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"]),v("div",O,[v("h4",null,"已选权限 ("+p(h.value.length)+")",1),v("div",z,[(i(!0),o(t,null,d(h.value,e=>(i(),c(b,{key:e,closable:"",onClose:a=>(e=>{const a=h.value.indexOf(e);a>-1&&h.value.splice(a,1)})(e),size:"small",style:{margin:"4px"}},{default:u(()=>[f(p(C(e)),1)]),_:2},1032,["onClose"]))),128))]),v("div",j,[r(E,{size:"small",onClick:x},{default:u(()=>[...a[3]||(a[3]=[f("全选",-1)])]),_:1}),r(E,{size:"small",onClick:A},{default:u(()=>[...a[4]||(a[4]=[f("清空",-1)])]),_:1}),r(T,{modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=e=>y.value=e),placeholder:"选择角色模板",size:"small",style:{width:"150px"}},{default:u(()=>[(i(!0),o(t,null,d(m(V),(e,a)=>(i(),c(U,{key:a,label:e.name,value:a,onClick:e=>(e=>{const a=V[e];a&&(h.value=[...a.permissions])})(a)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue"])])])])}}}),[["__scopeId","data-v-c0f315fb"]]),T={class:"roles-page"},N={class:"toolbar"},S={class:"toolbar-left"},D={class:"toolbar-right"},L={class:"permission-tags"},$={class:"permission-preview"},B={key:0,class:"no-permissions"},G=k(e({__name:"roles",setup(e){const s=a(!1),m=a(!1),k=a([{name:"admin",desc:"系统管理员",permissions:["*"],userCount:2},{name:"operator",desc:"运营专员",permissions:["user:view","order:view"],userCount:5},{name:"finance",desc:"财务专员",permissions:["finance:view","order:refund"],userCount:1}]),U=a(""),R=a({visible:!1,loading:!1,form:{name:"",desc:"",permissions:[]}}),I=async()=>{s.value=!0,s.value=!1},O=l(()=>U.value?k.value.filter(e=>e.name.includes(U.value)||(e.desc||"").includes(U.value)):k.value),z=()=>{},j=()=>{m.value=!1,R.value.visible=!0,R.value.form={name:"",desc:"",permissions:[]}},G=()=>{h.info("批量导入功能开发中...")},M=()=>{const e=JSON.stringify(k.value,null,2),a=new Blob([e],{type:"application/json"}),l=URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download="roles-config.json",s.click(),URL.revokeObjectURL(l),h.success("导出成功")},P=e=>"*"===e?"超级权限":(e=>{const[a,l]=e.split(":"),s=Object.values(C).find(e=>e===a),n=Object.values(x).find(e=>e===l);if(s&&n){const e=E[s];return`${(null==e?void 0:e.name)||a} - ${n}`}return e})(e),q=async()=>{if(R.value.form.name)if(0!==R.value.form.permissions.length){R.value.loading=!0;try{if(m.value){const e=k.value.findIndex(e=>e.name===R.value.form.name);e>-1&&(k.value[e]={...k.value[e],desc:R.value.form.desc,permissions:R.value.form.permissions}),h.success("更新成功")}else{if(k.value.some(e=>e.name===R.value.form.name))return void h.error("角色名已存在");k.value.push({name:R.value.form.name,desc:R.value.form.desc,permissions:R.value.form.permissions,userCount:0}),h.success("创建成功")}R.value.visible=!1}finally{R.value.loading=!1}}else h.warning("请至少选择一个权限");else h.warning("请输入角色名称")};return g(()=>{I()}),(e,a)=>{const l=n("el-input"),g=n("el-button"),C=n("el-tag"),x=n("el-table-column"),E=n("el-table"),F=n("el-form-item"),J=n("el-col"),K=n("el-row"),W=n("el-form"),X=n("el-dialog"),Y=_("loading");return i(),o("div",T,[v("div",N,[v("div",S,[r(l,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),placeholder:"角色名称",clearable:"",style:{width:"200px"},onClear:z,onKeyup:b(z,["enter"])},null,8,["modelValue"]),r(g,{type:"primary",onClick:j},{default:u(()=>[...a[6]||(a[6]=[f("新增角色",-1)])]),_:1}),r(g,{type:"success",onClick:G},{default:u(()=>[...a[7]||(a[7]=[f("批量导入",-1)])]),_:1})]),v("div",D,[r(g,{onClick:M},{default:u(()=>[...a[8]||(a[8]=[f("导出配置",-1)])]),_:1}),r(g,{onClick:I,loading:s.value},{default:u(()=>[...a[9]||(a[9]=[f("刷新",-1)])]),_:1},8,["loading"])])]),w((i(),c(E,{data:O.value,stripe:""},{default:u(()=>[r(x,{prop:"name",label:"角色名称",width:"180"},{default:u(({row:e})=>[r(C,{type:"admin"===e.name?"danger":"primary"},{default:u(()=>[f(p(e.name),1)]),_:2},1032,["type"])]),_:1}),r(x,{prop:"desc",label:"描述","min-width":"240"}),r(x,{prop:"permissions",label:"权限","min-width":"400"},{default:u(({row:e})=>[v("div",L,[(i(!0),o(t,null,d(e.permissions,e=>(i(),c(C,{key:e,size:"small",style:{"margin-right":"6px","margin-bottom":"4px"},type:"*"===e?"danger":"info"},{default:u(()=>[f(p(P(e)),1)]),_:2},1032,["type"]))),128))])]),_:1}),r(x,{prop:"userCount",label:"用户数",width:"100",align:"center"}),r(x,{label:"操作",width:"180",fixed:"right"},{default:u(({row:e})=>[r(g,{link:"",type:"primary",size:"small",onClick:a=>{return l=e,m.value=!0,R.value.visible=!0,void(R.value.form={name:l.name,desc:l.desc||"",permissions:[...l.permissions]});var l}},{default:u(()=>[...a[10]||(a[10]=[f(" 编辑 ",-1)])]),_:1},8,["onClick"]),r(g,{link:"",type:"success",size:"small",onClick:a=>{return l=e,m.value=!1,R.value.visible=!0,void(R.value.form={name:`${l.name}_copy`,desc:`${l.desc||""} (复制)`,permissions:[...l.permissions]});var l}},{default:u(()=>[...a[11]||(a[11]=[f(" 复制 ",-1)])]),_:1},8,["onClick"]),r(g,{link:"",type:"danger",size:"small",onClick:a=>(async e=>{try{await V.confirm(`确定要删除角色 "${e.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=k.value.findIndex(a=>a.name===e.name);a>-1&&(k.value.splice(a,1),h.success("删除成功"))}catch{}})(e),disabled:"admin"===e.name},{default:u(()=>[...a[12]||(a[12]=[f(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[Y,s.value]]),r(X,{modelValue:R.value.visible,"onUpdate:modelValue":a[5]||(a[5]=e=>R.value.visible=e),title:m.value?"编辑角色":"新增角色",width:"800px","close-on-click-modal":!1},{footer:u(()=>[r(g,{onClick:a[4]||(a[4]=e=>R.value.visible=!1)},{default:u(()=>[...a[13]||(a[13]=[f("取消",-1)])]),_:1}),r(g,{type:"primary",loading:R.value.loading,onClick:q},{default:u(()=>[...a[14]||(a[14]=[f(" 保存 ",-1)])]),_:1},8,["loading"])]),default:u(()=>[r(W,{model:R.value.form,"label-width":"100px"},{default:u(()=>[r(K,{gutter:20},{default:u(()=>[r(J,{span:12},{default:u(()=>[r(F,{label:"角色名称",required:""},{default:u(()=>[r(l,{modelValue:R.value.form.name,"onUpdate:modelValue":a[1]||(a[1]=e=>R.value.form.name=e),placeholder:"输入角色名称",disabled:m.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),r(J,{span:12},{default:u(()=>[r(F,{label:"描述"},{default:u(()=>[r(l,{modelValue:R.value.form.desc,"onUpdate:modelValue":a[2]||(a[2]=e=>R.value.form.desc=e),placeholder:"可选"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(F,{label:"权限配置"},{default:u(()=>[r(A,{modelValue:R.value.form.permissions,"onUpdate:modelValue":a[3]||(a[3]=e=>R.value.form.permissions=e)},null,8,["modelValue"])]),_:1}),r(F,{label:"权限预览"},{default:u(()=>[v("div",$,[0===R.value.form.permissions.length?(i(),o("span",B," 暂无权限 ")):y("",!0),(i(!0),o(t,null,d(R.value.form.permissions,e=>(i(),c(C,{key:e,size:"small",style:{margin:"2px"},type:"*"===e?"danger":"info"},{default:u(()=>[f(p(P(e)),1)]),_:2},1032,["type"]))),128))])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-44c628a7"]]);export{G as default};
