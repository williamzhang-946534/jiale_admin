import{v as e,k as a,r as l,l as r,ak as t,aq as d,y as o,B as i,E as s,C as n,D as u,u as p,M as m,ag as c,P as g,a3 as v,J as f,z as h,O as b,L as y}from"./vendor-60cd9ffe.js";import{v as w,x as _,E as C}from"./element-ca729cb6.js";import{u as z,f as k,a as N}from"./formatDate-ce0a9b4f.js";import{g as V,b as D,r as x}from"./order-c15f52de.js";import{_ as I}from"./index-30b3d731.js";const S={class:"order-list"},Y={class:"toolbar"},A={class:"toolbar-left"},U={class:"toolbar-right"},j={class:"table-container"},M={class:"pagination-container"},T=I(e({__name:"index",setup(e){const{confirm:I}=N(),{pagination:T,handleSizeChange:O,handleCurrentChange:P,resetPagination:B}=z(),E=a({page:1,pageSize:20,status:void 0,orderNo:"",startDate:"",endDate:""}),R=l([]),$=[{label:"待指派",value:"pending"},{label:"进行中",value:"in_progress"},{label:"已完成",value:"completed"},{label:"已取消",value:"cancelled"},{label:"已退款",value:"refunded"}],q=l(!1),J=l([]),K=l([]),L=l([{id:"1",name:"张三"},{id:"2",name:"李四"},{id:"3",name:"王五"}]),F=a({visible:!1,order:null,form:{providerId:""},loading:!1}),G=e=>({pending:"待指派",assigned:"已指派",in_progress:"进行中",completed:"已完成",cancelled:"已取消",refunded:"已退款"}[e]||"未知"),H=e=>{e&&2===e.length?(E.startDate=e[0],E.endDate=e[1]):(E.startDate="",E.endDate=""),W()},Q=async()=>{q.value=!0;try{const e={...E,page:T.page,pageSize:T.pageSize},a=await V(e);J.value=a.items,T.total=a.total}catch(e){C.error("获取订单列表失败"),J.value=[{id:"1",orderNo:"ORD20240115001",userId:"u1",userName:"用户A",serviceId:"s1",serviceName:"家政清洁",status:"pending",amount:150,address:"北京市朝阳区某某街道",scheduledTime:"2024-01-16 10:00:00",createdAt:"2024-01-15 14:30:00",updatedAt:"2024-01-15 14:30:00"},{id:"2",orderNo:"ORD20240115002",userId:"u2",userName:"用户B",providerId:"p1",providerName:"张三",serviceId:"s2",serviceName:"保姆服务",status:"in_progress",amount:200,address:"北京市海淀区某某街道",scheduledTime:"2024-01-17 14:00:00",createdAt:"2024-01-15 16:20:00",updatedAt:"2024-01-15 16:20:00"}],T.total=2}finally{q.value=!1}},W=()=>{T.page=1,Q()},X=()=>{Q()},Z=e=>{K.value=e},ee=async()=>{if(F.order&&F.form.providerId){F.loading=!0;try{await D(F.order.id,F.form.providerId),C.success("指派成功"),F.visible=!1,Q()}catch(e){C.error("指派失败")}finally{F.loading=!1}}else C.warning("请选择服务者")};return r(()=>{Q()}),(e,a)=>{const l=t("el-button"),r=t("el-input"),z=t("el-option"),N=t("el-select"),V=t("el-date-picker"),D=t("el-table-column"),B=t("el-tag"),K=t("el-table"),ae=t("el-pagination"),le=t("el-form-item"),re=t("el-form"),te=t("el-dialog"),de=d("permission"),oe=d("loading");return o(),i("div",S,[s("div",Y,[s("div",A,[n(l,{type:"primary",onClick:X},{default:u(()=>[n(p(w)),a[8]||(a[8]=m(" 刷新 ",-1))]),_:1})]),s("div",U,[n(r,{modelValue:E.orderNo,"onUpdate:modelValue":a[0]||(a[0]=e=>E.orderNo=e),placeholder:"订单号",style:{width:"150px"},clearable:"",onClear:W,onKeyup:c(W,["enter"])},{prefix:u(()=>[n(p(_))]),_:1},8,["modelValue"]),n(N,{modelValue:E.status,"onUpdate:modelValue":a[1]||(a[1]=e=>E.status=e),placeholder:"订单状态",style:{width:"120px"},clearable:"",onChange:W},{default:u(()=>[(o(),i(g,null,v($,e=>n(z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),n(V,{modelValue:R.value,"onUpdate:modelValue":a[2]||(a[2]=e=>R.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"},onChange:H},null,8,["modelValue"])])]),s("div",j,[f((o(),h(K,{data:J.value,stripe:"",style:{width:"100%"},onSelectionChange:Z},{default:u(()=>[n(D,{type:"selection",width:"55"}),n(D,{prop:"orderNo",label:"订单号",width:"180"}),n(D,{prop:"userName",label:"用户姓名",width:"120"}),n(D,{prop:"serviceName",label:"服务项目",width:"150"}),n(D,{label:"服务者",width:"120"},{default:u(({row:e})=>[m(b(e.providerName||"未指派"),1)]),_:1}),n(D,{label:"订单状态",width:"100"},{default:u(({row:e})=>{return[n(B,{type:(a=e.status,{pending:"warning",assigned:"info",in_progress:"primary",completed:"success",cancelled:"info",refunded:"danger"}[a]||"info"),size:"small"},{default:u(()=>[m(b(G(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),n(D,{prop:"amount",label:"金额",width:"100"},{default:u(({row:e})=>[m(" ¥"+b(e.amount),1)]),_:1}),n(D,{prop:"scheduledTime",label:"预约时间",width:"160"},{default:u(({row:e})=>[m(b(p(k)(e.scheduledTime)),1)]),_:1}),n(D,{prop:"createdAt",label:"下单时间",width:"160"},{default:u(({row:e})=>[m(b(p(k)(e.createdAt)),1)]),_:1}),n(D,{label:"操作",width:"200",fixed:"right"},{default:u(({row:e})=>{return["pending"===e.status?f((o(),h(l,{key:0,type:"primary",size:"small",onClick:a=>{return l=e,F.order=l,F.form.providerId="",void(F.visible=!0);var l}},{default:u(()=>[...a[9]||(a[9]=[m(" 指派 ",-1)])]),_:1},8,["onClick"])),[[de,["order:assign"]]]):y("",!0),(r=e.status,["pending","assigned","in_progress"].includes(r)?f((o(),h(l,{key:1,type:"danger",size:"small",onClick:a=>(async e=>{if(await I({message:`确定要对订单 ${e.orderNo} 进行强制退款吗？`,type:"warning"}))try{await x(e.id,"管理员强制退款"),C.success("退款成功"),Q()}catch(a){C.error("退款失败")}})(e)},{default:u(()=>[...a[10]||(a[10]=[m(" 退款 ",-1)])]),_:1},8,["onClick"])),[[de,["order:refund"]]]):y("",!0)),n(l,{type:"primary",size:"small",onClick:a=>{return l=e,void C.info(`查看订单 ${l.orderNo} 的详情`);var l}},{default:u(()=>[...a[11]||(a[11]=[m(" 详情 ",-1)])]),_:1},8,["onClick"])];var r}),_:1})]),_:1},8,["data"])),[[oe,q.value]]),s("div",M,[n(ae,{"current-page":p(T).page,"onUpdate:currentPage":a[3]||(a[3]=e=>p(T).page=e),"page-size":p(T).pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>p(T).pageSize=e),"page-sizes":p(T).pageSizes,total:p(T).total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:p(O),onCurrentChange:p(P)},null,8,["current-page","page-size","page-sizes","total","onSizeChange","onCurrentChange"])])]),n(te,{modelValue:F.visible,"onUpdate:modelValue":a[7]||(a[7]=e=>F.visible=e),title:"指派服务者",width:"500px"},{footer:u(()=>[n(l,{onClick:a[6]||(a[6]=e=>F.visible=!1)},{default:u(()=>[...a[12]||(a[12]=[m("取消",-1)])]),_:1}),n(l,{type:"primary",onClick:ee,loading:F.loading},{default:u(()=>[...a[13]||(a[13]=[m(" 确定指派 ",-1)])]),_:1},8,["loading"])]),default:u(()=>[n(re,{model:F.form,"label-width":"80px"},{default:u(()=>[n(le,{label:"选择服务者"},{default:u(()=>[n(N,{modelValue:F.form.providerId,"onUpdate:modelValue":a[5]||(a[5]=e=>F.form.providerId=e),placeholder:"请选择服务者",style:{width:"100%"},filterable:""},{default:u(()=>[(o(!0),i(g,null,v(L.value,e=>(o(),h(z,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-3be18640"]]);export{T as default};
