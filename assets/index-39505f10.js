import{v as e,r as l,k as a,l as o,ak as t,aq as i,y as d,B as n,E as u,C as r,ag as s,D as p,M as c,J as m,z as v,O as g}from"./vendor-60cd9ffe.js";import{g as b,a as f,b as y}from"./user-3272a809.js";import{E as _}from"./element-ca729cb6.js";import{_ as h}from"./index-30b3d731.js";const k={class:"user-page"},w={class:"toolbar"},z={class:"toolbar-left"},V={class:"toolbar-right"},C={class:"pager"},I=h(e({__name:"index",setup(e){const h=l(!1),I=l([]),x=l(!1),S=l(null),U=a({page:1,pageSize:20,total:0}),D=a({keyword:"",level:""}),j=a({visible:!1,user:null,couponId:"",loading:!1}),E=async()=>{h.value=!0;try{const e=await b({keyword:D.keyword||void 0,level:D.level||void 0,page:U.page,pageSize:U.pageSize});I.value=e.list,U.total=e.total}catch(e){_.error("获取用户列表失败")}finally{h.value=!1}},q=()=>{U.page=1,E()},A=()=>{E()},B=()=>{U.page=1,E()},J=async()=>{if(j.user&&j.couponId){j.loading=!0;try{await y(j.user.id,j.couponId),_.success("赠送成功"),j.visible=!1}catch(e){_.error("赠送失败")}finally{j.loading=!1}}else _.warning("请输入优惠券ID")},K=()=>E();return o(()=>{E()}),(e,l)=>{const a=t("el-input"),o=t("el-option"),b=t("el-select"),y=t("el-button"),E=t("el-table-column"),M=t("el-table"),O=t("el-pagination"),P=t("el-descriptions-item"),F=t("el-descriptions"),G=t("el-empty"),H=t("el-drawer"),L=t("el-form-item"),N=t("el-form"),Q=t("el-dialog"),R=i("loading");return d(),n("div",k,[u("div",w,[u("div",z,[r(a,{modelValue:D.keyword,"onUpdate:modelValue":l[0]||(l[0]=e=>D.keyword=e),placeholder:"手机号 / 昵称",clearable:"",style:{width:"220px"},onClear:q,onKeyup:s(q,["enter"])},null,8,["modelValue"]),r(b,{modelValue:D.level,"onUpdate:modelValue":l[1]||(l[1]=e=>D.level=e),placeholder:"会员等级",clearable:"",style:{width:"140px"},onChange:q},{default:p(()=>[r(o,{label:"全部",value:""}),r(o,{label:"普通",value:"normal"}),r(o,{label:"会员",value:"vip"})]),_:1},8,["modelValue"]),r(y,{type:"primary",loading:h.value,onClick:q},{default:p(()=>[...l[8]||(l[8]=[c(" 查询 ",-1)])]),_:1},8,["loading"])]),u("div",V,[r(y,{type:"primary",onClick:K},{default:p(()=>[...l[9]||(l[9]=[c(" 刷新 ",-1)])]),_:1})])]),m((d(),v(M,{data:I.value,stripe:""},{default:p(()=>[r(E,{prop:"id",label:"ID",width:"120"}),r(E,{prop:"username",label:"用户名",width:"140"}),r(E,{prop:"nickname",label:"昵称",width:"140"}),r(E,{prop:"phone",label:"手机号",width:"160"}),r(E,{prop:"level",label:"等级",width:"100"}),r(E,{prop:"createdAt",label:"创建时间","min-width":"180"}),r(E,{label:"操作",width:"180"},{default:p(({row:e})=>[r(y,{link:"",type:"primary",size:"small",onClick:l=>(async e=>{x.value=!0,S.value=null;try{S.value=await f(e.id)}catch(l){_.error("获取用户详情失败")}})(e)},{default:p(()=>[...l[10]||(l[10]=[c(" 详情 ",-1)])]),_:1},8,["onClick"]),r(y,{link:"",type:"success",size:"small",onClick:l=>(e=>{j.user=e,j.couponId="",j.visible=!0})(e)},{default:p(()=>[...l[11]||(l[11]=[c(" 赠券 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,h.value]]),u("div",C,[r(O,{background:"",layout:"total, prev, pager, next, sizes","page-sizes":[10,20,50],total:U.total,"current-page":U.page,"onUpdate:currentPage":l[2]||(l[2]=e=>U.page=e),"page-size":U.pageSize,"onUpdate:pageSize":l[3]||(l[3]=e=>U.pageSize=e),onCurrentChange:A,onSizeChange:B},null,8,["total","current-page","page-size"])]),r(H,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=e=>x.value=e),title:"用户详情",size:"40%"},{default:p(()=>[S.value?(d(),v(F,{key:0,column:1,border:""},{default:p(()=>[r(P,{label:"ID"},{default:p(()=>[c(g(S.value.id),1)]),_:1}),r(P,{label:"用户名"},{default:p(()=>[c(g(S.value.username),1)]),_:1}),r(P,{label:"昵称"},{default:p(()=>[c(g(S.value.nickname||S.value.name),1)]),_:1}),r(P,{label:"手机号"},{default:p(()=>[c(g(S.value.phone||"-"),1)]),_:1}),r(P,{label:"等级"},{default:p(()=>[c(g(S.value.level||"-"),1)]),_:1})]),_:1})):(d(),v(G,{key:1,description:"暂无数据"}))]),_:1},8,["modelValue"]),r(Q,{modelValue:j.visible,"onUpdate:modelValue":l[7]||(l[7]=e=>j.visible=e),title:"赠送优惠券",width:"400px"},{footer:p(()=>[r(y,{onClick:l[6]||(l[6]=e=>j.visible=!1)},{default:p(()=>[...l[12]||(l[12]=[c("取消",-1)])]),_:1}),r(y,{type:"primary",loading:j.loading,onClick:J},{default:p(()=>[...l[13]||(l[13]=[c(" 赠送 ",-1)])]),_:1},8,["loading"])]),default:p(()=>[r(N,{model:j,"label-width":"100px"},{default:p(()=>[r(L,{label:"用户"},{default:p(()=>{var e,l;return[u("span",null,g((null==(e=j.user)?void 0:e.nickname)||(null==(l=j.user)?void 0:l.username)),1)]}),_:1}),r(L,{label:"优惠券ID"},{default:p(()=>[r(a,{modelValue:j.couponId,"onUpdate:modelValue":l[5]||(l[5]=e=>j.couponId=e),placeholder:"输入优惠券ID"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-2ebeca7c"]]);export{I as default};
