import{v as e,k as a,r as l,c as r,w as t,l as d,ak as s,aq as o,y as i,B as n,E as u,C as c,D as m,u as v,M as p,z as f,O as g,L as b,ag as y,P as _,a3 as h,J as w}from"./vendor-60cd9ffe.js";import{v as k,x as V,d as x,s as N,G as C,u as z,C as U,y as I,E as D,f as S}from"./element-ca729cb6.js";import{g as T,a as Y,b as $,r as j}from"./order-c15f52de.js";import{g as P}from"./provider-12b388c0.js";import{_ as R}from"./index-30b3d731.js";const q={class:"order-list"},B={class:"toolbar"},M={class:"toolbar-left"},O={class:"toolbar-right"},E={class:"stats-cards"},L={class:"stat-content"},G={class:"stat-number"},J={class:"stat-content"},K={class:"stat-number"},A={class:"stat-content"},F={class:"stat-number"},H={class:"stat-content"},Q={class:"stat-number"},W={class:"table-container"},X={class:"order-info"},Z={class:"order-no"},ee={class:"order-service"},ae={class:"order-time"},le={class:"customer-info"},re={class:"customer-header"},te={class:"customer-name"},de={class:"customer-details"},se={key:0,class:"customer-address-item"},oe={class:"customer-address"},ie={key:1,class:"customer-phone-item"},ne={class:"customer-phone"},ue={key:0,class:"provider-info"},ce={class:"provider-name"},me={key:2,class:"no-provider"},ve={class:"amount"},pe={class:"service-time"},fe={class:"pagination-container"},ge={class:"assign-content"},be={class:"provider-option"},ye={key:0,class:"order-detail"},_e={key:0,class:"timeline-section"},he={key:1,class:"review-section"},we={class:"review-content"},ke={key:0,class:"refund-hint"},Ve=R(e({__name:"enhanced",setup(e){const R=a({orderNo:"",status:"",dateRange:void 0,page:1,pageSize:20}),Ve=a({page:1,pageSize:20,total:0,pageSizes:[10,20,50,100]}),xe=l(null),Ne=[{label:"待指派",value:"pending"},{label:"已接受",value:"accepted"},{label:"已到达",value:"arrived"},{label:"服务中",value:"in_service"},{label:"已完成",value:"completed"},{label:"已取消",value:"cancelled"}],Ce=l(!1),ze=l([]),Ue=l([]),Ie=l([]),De=r(()=>({total:ze.value.length,pending:ze.value.filter(e=>"pending"===e.status).length,processing:ze.value.filter(e=>["accepted","arrived","in_service"].includes(e.status)).length,completed:ze.value.filter(e=>"completed"===e.status).length})),Se=r(()=>Ue.value.filter(e=>"pending"===e.status).length),Te=r(()=>Ue.value.some(e=>"pending"===e.status)),Ye=a({visible:!1,order:null,form:{providerId:""},loading:!1}),$e=a({visible:!1,order:null}),je=a({visible:!1,order:null,form:{type:"full",amount:0,reason:""},loading:!1}),Pe=e=>({pending:"warning",accepted:"primary",arrived:"info",in_service:"success",completed:"success",cancelled:"danger"}[e]||"info"),Re=e=>({pending:"待指派",accepted:"已接受",arrived:"已到达",in_service:"服务中",completed:"已完成",cancelled:"已取消"}[e]||"未知"),qe=e=>({created:"primary",accepted:"success",arrived:"info",started:"warning",completed:"success"}[e]||"info"),Be=e=>({created:"订单创建",accepted:"服务者接受",arrived:"服务者到达",started:"开始服务",completed:"服务完成"}[e]||e),Me=e=>new Date(e).toLocaleString("zh-CN"),Oe=async()=>{Ce.value=!0;try{const e={...R,page:Ve.page,pageSize:Ve.pageSize},a=await T(e);ze.value=a.list,Ve.total=a.total}catch(e){D.error("获取订单列表失败"),ze.value=[{id:"1",orderNo:"ORD-2024-001",serviceId:"service-1",serviceName:"家庭日常保洁",userId:"user-1",userName:"张三",userPhone:"13800138001",providerId:"",providerName:"",status:"pending",amount:180,address:"北京市朝阳区xxx街道xxx号",serviceDate:"2024-01-20",serviceTime:"14:00",specialRequests:"请自带清洁工具",createTime:"2024-01-19 10:30:00",timeline:{created:"2024-01-19 10:30:00"}},{id:"2",orderNo:"ORD-2024-002",serviceId:"service-2",serviceName:"金牌月嫂服务",userId:"user-2",userName:"李四",userPhone:"13800138002",providerId:"provider-1",providerName:"王阿姨",status:"in_service",amount:1200,address:"上海市浦东新区xxx路xxx号",serviceDate:"2024-01-20",serviceTime:"09:00",createTime:"2024-01-18 15:20:00",timeline:{created:"2024-01-18 15:20:00",accepted:"2024-01-18 16:00:00",arrived:"2024-01-20 08:55:00",started:"2024-01-20 09:00:00"}}],Ve.total=2}finally{Ce.value=!1}},Ee=()=>{Ve.page=1,Oe()},Le=()=>{Oe()},Ge=e=>{R.dateRange=e?{start:e[0],end:e[1]}:void 0,Ee()},Je=e=>{Ue.value=e},Ke=e=>{Ye.order=e,Ye.form.providerId="",Ye.visible=!0,(async()=>{try{const e=await P({status:"verified"});Ie.value=e.list}catch(e){Ie.value=[{id:"provider-1",name:"王阿姨",rating:4.8,phone:"13800138001"},{id:"provider-2",name:"李师傅",rating:4.5,phone:"13800138002"}]}})()},Ae=async()=>{if(Ye.order&&Ye.form.providerId){Ye.loading=!0;try{const e={providerId:Ye.form.providerId};await $(Ye.order.id,e),D.success("指派成功"),Ye.visible=!1,Oe()}catch(e){D.error("指派失败")}finally{Ye.loading=!1}}else D.warning("请选择服务者")},Fe=async()=>{0!==Ue.value.filter(e=>"pending"===e.status).length?D.info("批量指派功能开发中，请单独指派每个订单"):D.warning("请选择待指派的订单")},He=async()=>{try{await S.confirm(`确定要取消选中的 ${Ue.value.length} 个订单吗？`,"批量取消确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),D.success("批量取消成功"),Oe()}catch(e){"cancel"!==e&&D.error("批量取消失败")}},Qe=async()=>{if(!je.order||!je.form.reason)return void D.warning("请输入退款原因");const e="full"===je.form.type?je.order.amount:je.form.amount;if(e<=0||e>je.order.amount)D.warning("请输入正确的退款金额");else{je.loading=!0;try{const a={amount:e,reason:je.form.reason,type:je.form.type};await j(je.order.id,a),D.success("退款申请已提交"),je.visible=!1,Oe()}catch(a){D.error("退款申请失败")}finally{je.loading=!1}}};t(()=>je.form.type,e=>{"full"===e&&je.order&&(je.form.amount=je.order.amount)});const We=e=>{Ve.pageSize=e,Ve.page=1,Oe()},Xe=e=>{Ve.page=e,Oe()};return d(()=>{Oe()}),(e,a)=>{var l,r,t;const d=s("el-button"),T=s("el-input"),$=s("el-option"),j=s("el-select"),P=s("el-date-picker"),Ze=s("el-card"),ea=s("el-table-column"),aa=s("el-icon"),la=s("el-avatar"),ra=s("el-tag"),ta=s("el-table"),da=s("el-pagination"),sa=s("el-descriptions-item"),oa=s("el-descriptions"),ia=s("el-rate"),na=s("el-form-item"),ua=s("el-form"),ca=s("el-dialog"),ma=s("el-timeline-item"),va=s("el-timeline"),pa=s("el-radio"),fa=s("el-radio-group"),ga=s("el-input-number"),ba=o("loading");return i(),n("div",q,[u("div",B,[u("div",M,[c(d,{type:"primary",onClick:Le},{default:m(()=>[c(v(k)),a[15]||(a[15]=p(" 刷新 ",-1))]),_:1}),Ue.value.length>0?(i(),f(d,{key:0,type:"success",onClick:Fe,disabled:!Te.value},{default:m(()=>[p(" 批量指派 ("+g(Se.value)+") ",1)]),_:1},8,["disabled"])):b("",!0),Ue.value.length>0?(i(),f(d,{key:1,type:"danger",onClick:He},{default:m(()=>[p(" 批量取消 ("+g(Ue.value.length)+") ",1)]),_:1})):b("",!0)]),u("div",O,[c(T,{modelValue:R.orderNo,"onUpdate:modelValue":a[0]||(a[0]=e=>R.orderNo=e),placeholder:"订单号",style:{width:"150px"},clearable:"",onClear:Ee,onKeyup:y(Ee,["enter"])},{prefix:m(()=>[c(v(V))]),_:1},8,["modelValue"]),c(j,{modelValue:R.status,"onUpdate:modelValue":a[1]||(a[1]=e=>R.status=e),placeholder:"订单状态",style:{width:"120px"},clearable:"",onChange:Ee},{default:m(()=>[(i(),n(_,null,h(Ne,e=>c($,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),c(P,{modelValue:xe.value,"onUpdate:modelValue":a[2]||(a[2]=e=>xe.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"},onChange:Ge},null,8,["modelValue"])])]),u("div",E,[c(Ze,{class:"stat-card"},{default:m(()=>[u("div",L,[u("div",G,g(De.value.total),1),a[16]||(a[16]=u("div",{class:"stat-label"},"总订单数",-1))])]),_:1}),c(Ze,{class:"stat-card pending"},{default:m(()=>[u("div",J,[u("div",K,g(De.value.pending),1),a[17]||(a[17]=u("div",{class:"stat-label"},"待指派",-1))])]),_:1}),c(Ze,{class:"stat-card processing"},{default:m(()=>[u("div",A,[u("div",F,g(De.value.processing),1),a[18]||(a[18]=u("div",{class:"stat-label"},"进行中",-1))])]),_:1}),c(Ze,{class:"stat-card completed"},{default:m(()=>[u("div",H,[u("div",Q,g(De.value.completed),1),a[19]||(a[19]=u("div",{class:"stat-label"},"已完成",-1))])]),_:1})]),u("div",W,[w((i(),f(ta,{data:ze.value,stripe:"",style:{width:"100%"},onSelectionChange:Je},{default:m(()=>[c(ea,{type:"selection",width:"55"}),c(ea,{label:"订单信息","min-width":"220"},{default:m(({row:e})=>[u("div",X,[u("div",Z,[c(aa,{class:"order-icon"},{default:m(()=>[c(v(x))]),_:1}),p(" "+g(e.orderNo),1)]),u("div",ee,[c(aa,{class:"service-icon"},{default:m(()=>[c(v(N))]),_:1}),p(" "+g(e.serviceName),1)]),u("div",ae,[c(aa,{class:"time-icon"},{default:m(()=>[c(v(C))]),_:1}),p(" "+g(Me(e.createTime)),1)])])]),_:1}),c(ea,{label:"客户信息",width:"180"},{default:m(({row:e})=>{return[u("div",le,[u("div",re,[c(la,{size:24,class:"customer-avatar"},{default:m(()=>[c(aa,null,{default:m(()=>[c(v(z))]),_:1})]),_:1}),u("span",te,g(e.userName||"未知客户"),1)]),u("div",de,[e.address?(i(),n("div",se,[c(aa,{class:"address-icon"},{default:m(()=>[c(v(U))]),_:1}),u("span",oe,g((a=e.address,a?a.length>20?a.substring(0,20)+"...":a:"")),1)])):b("",!0),e.userPhone?(i(),n("div",ie,[c(aa,{class:"phone-icon"},{default:m(()=>[c(v(I))]),_:1}),u("span",ne,g(e.userPhone),1)])):b("",!0)])])];var a}),_:1}),c(ea,{label:"服务者",width:"120"},{default:m(({row:e})=>[e.providerName?(i(),n("div",ue,[u("div",ce,g(e.providerName),1)])):"pending"===e.status?(i(),f(d,{key:1,type:"primary",size:"small",onClick:a=>Ke(e)},{default:m(()=>[...a[20]||(a[20]=[p(" 指派 ",-1)])]),_:1},8,["onClick"])):(i(),n("span",me,"未指派"))]),_:1}),c(ea,{label:"状态",width:"100"},{default:m(({row:e})=>[c(ra,{type:Pe(e.status),size:"small"},{default:m(()=>[p(g(Re(e.status)),1)]),_:2},1032,["type"])]),_:1}),c(ea,{label:"金额",width:"100",align:"right"},{default:m(({row:e})=>[u("div",ve,"¥"+g(e.amount),1)]),_:1}),c(ea,{label:"服务时间",width:"150"},{default:m(({row:e})=>[u("div",pe,[u("div",null,g(e.serviceDate),1),u("div",null,g(e.serviceTime),1)])]),_:1}),c(ea,{label:"操作",width:"200",fixed:"right"},{default:m(({row:e})=>[c(d,{type:"primary",size:"small",onClick:a=>(async e=>{try{const a=await Y(e.id);$e.order=a,$e.visible=!0}catch(a){D.error("获取订单详情失败"),$e.order=e,$e.visible=!0}})(e)},{default:m(()=>[...a[21]||(a[21]=[p(" 详情 ",-1)])]),_:1},8,["onClick"]),"pending"===e.status?(i(),f(d,{key:0,type:"success",size:"small",onClick:a=>Ke(e)},{default:m(()=>[...a[22]||(a[22]=[p(" 指派 ",-1)])]),_:1},8,["onClick"])):b("",!0),["pending","accepted"].includes(e.status)?(i(),f(d,{key:1,type:"danger",size:"small",onClick:a=>(async e=>{try{await S.confirm(`确定要取消订单 ${e.orderNo} 吗？`,"取消确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),D.success("订单已取消"),Oe()}catch(a){"cancel"!==a&&D.error("取消失败")}})(e)},{default:m(()=>[...a[23]||(a[23]=[p(" 取消 ",-1)])]),_:1},8,["onClick"])):b("",!0),"completed"!==e.status||e.review?b("",!0):(i(),f(d,{key:2,type:"warning",size:"small",onClick:a=>{return l=e,je.order=l,je.form={type:"full",amount:l.amount,reason:""},void(je.visible=!0);var l}},{default:m(()=>[...a[24]||(a[24]=[p(" 退款 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])),[[ba,Ce.value]]),u("div",fe,[c(da,{"current-page":Ve.page,"onUpdate:currentPage":a[3]||(a[3]=e=>Ve.page=e),"page-size":Ve.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>Ve.pageSize=e),"page-sizes":Ve.pageSizes,total:Ve.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:We,onCurrentChange:Xe},null,8,["current-page","page-size","page-sizes","total"])])]),c(ca,{modelValue:Ye.visible,"onUpdate:modelValue":a[7]||(a[7]=e=>Ye.visible=e),title:`指派订单 - ${null==(l=Ye.order)?void 0:l.orderNo}`,width:"500px","close-on-click-modal":!1},{footer:m(()=>[c(d,{onClick:a[6]||(a[6]=e=>Ye.visible=!1)},{default:m(()=>[...a[25]||(a[25]=[p("取消",-1)])]),_:1}),c(d,{type:"primary",loading:Ye.loading,onClick:Ae},{default:m(()=>[...a[26]||(a[26]=[p(" 确认指派 ",-1)])]),_:1},8,["loading"])]),default:m(()=>[u("div",ge,[c(oa,{column:1,border:""},{default:m(()=>[c(sa,{label:"订单号"},{default:m(()=>{var e;return[p(g(null==(e=Ye.order)?void 0:e.orderNo),1)]}),_:1}),c(sa,{label:"服务"},{default:m(()=>{var e;return[p(g(null==(e=Ye.order)?void 0:e.serviceName),1)]}),_:1}),c(sa,{label:"客户"},{default:m(()=>{var e;return[p(g(null==(e=Ye.order)?void 0:e.userName),1)]}),_:1}),c(sa,{label:"地址"},{default:m(()=>{var e;return[p(g(null==(e=Ye.order)?void 0:e.address),1)]}),_:1}),c(sa,{label:"服务时间"},{default:m(()=>{var e,a;return[p(g(null==(e=Ye.order)?void 0:e.serviceDate)+" "+g(null==(a=Ye.order)?void 0:a.serviceTime),1)]}),_:1})]),_:1}),c(ua,{model:Ye.form,"label-width":"100px",style:{"margin-top":"20px"}},{default:m(()=>[c(na,{label:"选择服务者",required:""},{default:m(()=>[c(j,{modelValue:Ye.form.providerId,"onUpdate:modelValue":a[5]||(a[5]=e=>Ye.form.providerId=e),placeholder:"请选择服务者",style:{width:"100%"},filterable:""},{default:m(()=>[(i(!0),n(_,null,h(Ie.value,e=>(i(),f($,{key:e.id,label:`${e.name} (评分: ${e.rating})`,value:e.id},{default:m(()=>[u("div",be,[u("span",null,g(e.name),1),c(ia,{modelValue:e.rating,"onUpdate:modelValue":a=>e.rating=a,disabled:"",size:"small",style:{"margin-left":"10px"}},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue","title"]),c(ca,{modelValue:$e.visible,"onUpdate:modelValue":a[9]||(a[9]=e=>$e.visible=e),title:`订单详情 - ${null==(r=$e.order)?void 0:r.orderNo}`,width:"800px"},{default:m(()=>[$e.order?(i(),n("div",ye,[c(oa,{column:2,border:""},{default:m(()=>[c(sa,{label:"订单号"},{default:m(()=>[p(g($e.order.orderNo),1)]),_:1}),c(sa,{label:"服务"},{default:m(()=>[p(g($e.order.serviceName),1)]),_:1}),c(sa,{label:"客户"},{default:m(()=>[p(g($e.order.userName),1)]),_:1}),c(sa,{label:"服务者"},{default:m(()=>[p(g($e.order.providerName||"未指派"),1)]),_:1}),c(sa,{label:"状态"},{default:m(()=>[c(ra,{type:Pe($e.order.status)},{default:m(()=>[p(g(Re($e.order.status)),1)]),_:1},8,["type"])]),_:1}),c(sa,{label:"金额"},{default:m(()=>[p("¥"+g($e.order.amount),1)]),_:1}),c(sa,{label:"服务地址"},{default:m(()=>[p(g($e.order.address),1)]),_:1}),c(sa,{label:"服务时间"},{default:m(()=>[p(g($e.order.serviceDate)+" "+g($e.order.serviceTime),1)]),_:1}),c(sa,{label:"特殊要求",span:"2"},{default:m(()=>[p(g($e.order.specialRequests||"无"),1)]),_:1})]),_:1}),$e.order.timeline?(i(),n("div",_e,[a[27]||(a[27]=u("h4",null,"订单时间轴",-1)),c(va,null,{default:m(()=>[(i(!0),n(_,null,h($e.order.timeline,(e,a)=>(i(),f(ma,{key:a,timestamp:e,type:qe(a)},{default:m(()=>[p(g(Be(a)),1)]),_:2},1032,["timestamp","type"]))),128))]),_:1})])):b("",!0),$e.order.review?(i(),n("div",he,[a[28]||(a[28]=u("h4",null,"客户评价",-1)),u("div",we,[c(ia,{modelValue:$e.order.review.rating,"onUpdate:modelValue":a[8]||(a[8]=e=>$e.order.review.rating=e),disabled:"","show-score":"","text-color":"#ff9900"},null,8,["modelValue"]),u("p",null,g($e.order.review.content),1),u("small",null,g(Me($e.order.review.createTime)),1)])])):b("",!0)])):b("",!0)]),_:1},8,["modelValue","title"]),c(ca,{modelValue:je.visible,"onUpdate:modelValue":a[14]||(a[14]=e=>je.visible=e),title:`订单退款 - ${null==(t=je.order)?void 0:t.orderNo}`,width:"500px","close-on-click-modal":!1},{footer:m(()=>[c(d,{onClick:a[13]||(a[13]=e=>je.visible=!1)},{default:m(()=>[...a[31]||(a[31]=[p("取消",-1)])]),_:1}),c(d,{type:"danger",loading:je.loading,onClick:Qe},{default:m(()=>[...a[32]||(a[32]=[p(" 确认退款 ",-1)])]),_:1},8,["loading"])]),default:m(()=>[c(ua,{model:je.form,"label-width":"100px"},{default:m(()=>[c(na,{label:"退款类型"},{default:m(()=>[c(fa,{modelValue:je.form.type,"onUpdate:modelValue":a[10]||(a[10]=e=>je.form.type=e)},{default:m(()=>[c(pa,{label:"full"},{default:m(()=>[...a[29]||(a[29]=[p("全额退款",-1)])]),_:1}),c(pa,{label:"partial"},{default:m(()=>[...a[30]||(a[30]=[p("部分退款",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),c(na,{label:"退款金额"},{default:m(()=>{var e,l;return[c(ga,{modelValue:je.form.amount,"onUpdate:modelValue":a[11]||(a[11]=e=>je.form.amount=e),min:0,max:(null==(e=je.order)?void 0:e.amount)||0,precision:2,style:{width:"100%"},disabled:"full"===je.form.type},null,8,["modelValue","max","disabled"]),"full"===je.form.type?(i(),n("div",ke," 全额退款: ¥"+g(null==(l=je.order)?void 0:l.amount),1)):b("",!0)]}),_:1}),c(na,{label:"退款原因",required:""},{default:m(()=>[c(T,{modelValue:je.form.reason,"onUpdate:modelValue":a[12]||(a[12]=e=>je.form.reason=e),type:"textarea",placeholder:"请输入退款原因",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-5bb27f61"]]);export{Ve as default};
