import{E as e}from"./element-ca729cb6.js";import{v as s,r as a,c as t,l,ak as i,y as r,B as n,E as u,C as o,D as c,M as d,O as v,P as m,a3 as p,G as f,z as g}from"./vendor-60cd9ffe.js";import{_ as h}from"./index-30b3d731.js";const y={class:"permission-analysis"},b={class:"toolbar"},_={class:"toolbar-right"},w={class:"overview-stats"},C={class:"stat-item"},k={class:"stat-value"},x={class:"stat-item"},E={class:"stat-value"},j={class:"stat-item"},P={class:"stat-value"},O={class:"permission-chart"},z={class:"chart-label"},M={class:"chart-bar"},N={class:"chart-value"},$={class:"role-usage"},B={class:"usage-info"},D={class:"usage-name"},G={class:"usage-count"},I={class:"conflict-detection"},q={key:1,class:"conflict-list"},A=h(s({__name:"analysis-simple",setup(s){const h=a([{name:"admin",desc:"系统管理员",permissions:["*"],userCount:2},{name:"operator",desc:"运营专员",permissions:["user:view","order:view"],userCount:5},{name:"finance",desc:"财务专员",permissions:["finance:view","order:refund"],userCount:1},{name:"super_user",desc:"超级用户",permissions:["user:view","user:edit","user:delete","order:view","order:assign"],userCount:3}]),A=a([]),F=a([]),H=t(()=>h.value.length),J=t(()=>20),K=t(()=>h.value.reduce((e,s)=>e+s.userCount,0)),L=t(()=>{const e={user:0,order:0,provider:0,finance:0,marketing:0,system:0};return h.value.forEach(s=>{s.permissions.includes("*")?Object.keys(e).forEach(a=>{e[a]+=s.userCount}):s.permissions.forEach(a=>{const[t]=a.split(":");void 0!==e[t]&&(e[t]+=s.userCount)})}),e}),Q=t(()=>Math.max(...Object.values(L.value))),R=t(()=>h.value.filter(e=>e.userCount>0).sort((e,s)=>s.userCount-e.userCount).slice(0,5)),S=e=>({user:"用户管理",order:"订单管理",provider:"服务者管理",finance:"财务管理",marketing:"营销管理",system:"系统管理"}[e]||e),T=()=>{const s=[];h.value.forEach(e=>{e.permissions.length>10&&"*"!==e.permissions[0]&&s.push({description:`角色 "${e.name}" 拥有过多权限 (${e.permissions.length}个)，建议拆分`,severity:"warning"})}),A.value=s;const a=[];h.value.forEach(e=>{if("*"===e.permissions[0])return;const s=[];e.permissions.some(e=>e.includes(":delete"))&&e.permissions.forEach(e=>{e.includes(":view")&&s.push(e)}),s.length>0&&a.push({roleName:e.name,redundantPermissions:s,suggestion:"删除权限冗余，简化权限配置"})}),F.value=a,e.success("分析报告已生成")},U=()=>{T(),e.success("数据已刷新")};return l(()=>{T()}),(e,s)=>{const a=i("el-button"),t=i("el-card"),l=i("el-col"),h=i("el-progress"),V=i("el-row"),W=i("el-alert"),X=i("el-table-column"),Y=i("el-tag"),Z=i("el-table");return r(),n("div",y,[u("div",b,[s[2]||(s[2]=u("div",{class:"toolbar-left"},[u("h2",null,"权限分析中心")],-1)),u("div",_,[o(a,{type:"primary",onClick:T},{default:c(()=>[...s[0]||(s[0]=[d("生成报告",-1)])]),_:1}),o(a,{onClick:U},{default:c(()=>[...s[1]||(s[1]=[d("刷新数据",-1)])]),_:1})])]),o(V,{gutter:20},{default:c(()=>[o(l,{span:8},{default:c(()=>[o(t,{title:"权限概览"},{default:c(()=>[u("div",w,[u("div",C,[u("div",k,v(H.value),1),s[3]||(s[3]=u("div",{class:"stat-label"},"总角色数",-1))]),u("div",x,[u("div",E,v(J.value),1),s[4]||(s[4]=u("div",{class:"stat-label"},"总权限点",-1))]),u("div",j,[u("div",P,v(K.value),1),s[5]||(s[5]=u("div",{class:"stat-label"},"总用户数",-1))])])]),_:1})]),_:1}),o(l,{span:8},{default:c(()=>[o(t,{title:"权限分布"},{default:c(()=>[u("div",O,[(r(!0),n(m,null,p(L.value,(e,s)=>(r(),n("div",{key:s,class:"chart-item"},[u("div",z,v(S(s)),1),u("div",M,[u("div",{class:"chart-fill",style:f({width:e/Q.value*100+"%"})},null,4)]),u("div",N,v(e),1)]))),128))])]),_:1})]),_:1}),o(l,{span:8},{default:c(()=>[o(t,{title:"角色使用情况"},{default:c(()=>[u("div",$,[(r(!0),n(m,null,p(R.value,e=>(r(),n("div",{key:e.name,class:"usage-item"},[u("div",B,[u("span",D,v(e.name),1),u("span",G,v(e.userCount)+" 用户",1)]),o(h,{percentage:e.userCount/K.value*100,"stroke-width":8,"show-text":!1},null,8,["percentage"])]))),128))])]),_:1})]),_:1})]),_:1}),o(t,{title:"权限冲突检测",style:{"margin-top":"20px"}},{default:c(()=>[u("div",I,[0===A.value.length?(r(),g(W,{key:0,title:"未发现权限冲突",type:"success",closable:!1})):(r(),n("div",q,[(r(!0),n(m,null,p(A.value,(e,s)=>(r(),g(W,{key:s,title:e.description,type:e.severity,style:{"margin-bottom":"8px"}},null,8,["title","type"]))),128))]))])]),_:1}),o(t,{title:"权限冗余分析",style:{"margin-top":"20px"}},{default:c(()=>[o(Z,{data:F.value,stripe:""},{default:c(()=>[o(X,{prop:"roleName",label:"角色名称",width:"150"}),o(X,{prop:"redundantPermissions",label:"冗余权限","min-width":"300"},{default:c(({row:e})=>[(r(!0),n(m,null,p(e.redundantPermissions,e=>(r(),g(Y,{key:e,size:"small",type:"warning",style:{"margin-right":"6px"}},{default:c(()=>[d(v(e),1)]),_:2},1024))),128))]),_:1}),o(X,{prop:"suggestion",label:"建议","min-width":"200"})]),_:1},8,["data"])]),_:1})])}}}),[["__scopeId","data-v-b42e17bb"]]);export{A as default};
